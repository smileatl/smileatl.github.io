<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>容器container | SAL Repo</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/website_icon.png">
    <meta name="description" content="smileatl个人知识库，用于工作、学习、生活的总结。">
    <meta name="keywords" content="smileatl个人知识库，用于工作、学习、生活的总结。">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.27efc831.css" as="style"><link rel="preload" href="/assets/js/app.4813674f.js" as="script"><link rel="preload" href="/assets/js/3.cf27d530.js" as="script"><link rel="preload" href="/assets/js/219.43da1c82.js" as="script"><link rel="prefetch" href="/assets/js/10.57c72187.js"><link rel="prefetch" href="/assets/js/100.76551019.js"><link rel="prefetch" href="/assets/js/101.909b1f6a.js"><link rel="prefetch" href="/assets/js/102.b4df429c.js"><link rel="prefetch" href="/assets/js/103.36718b70.js"><link rel="prefetch" href="/assets/js/104.8247d5e5.js"><link rel="prefetch" href="/assets/js/105.ae996141.js"><link rel="prefetch" href="/assets/js/106.664e0ec8.js"><link rel="prefetch" href="/assets/js/107.34387111.js"><link rel="prefetch" href="/assets/js/108.24bd216e.js"><link rel="prefetch" href="/assets/js/109.0ce14ec5.js"><link rel="prefetch" href="/assets/js/11.a6b1ea70.js"><link rel="prefetch" href="/assets/js/110.225cb77d.js"><link rel="prefetch" href="/assets/js/111.987f1649.js"><link rel="prefetch" href="/assets/js/112.804919d1.js"><link rel="prefetch" href="/assets/js/113.61edc8e7.js"><link rel="prefetch" href="/assets/js/114.a2199a4f.js"><link rel="prefetch" href="/assets/js/115.919528ee.js"><link rel="prefetch" href="/assets/js/116.1e165300.js"><link rel="prefetch" href="/assets/js/117.b62cd913.js"><link rel="prefetch" href="/assets/js/118.157a5849.js"><link rel="prefetch" href="/assets/js/119.335bb0f4.js"><link rel="prefetch" href="/assets/js/12.f97190ac.js"><link rel="prefetch" href="/assets/js/120.8ca841a0.js"><link rel="prefetch" href="/assets/js/121.09ef443a.js"><link rel="prefetch" href="/assets/js/122.133de093.js"><link rel="prefetch" href="/assets/js/123.8b5fcdde.js"><link rel="prefetch" href="/assets/js/124.8aef67d0.js"><link rel="prefetch" href="/assets/js/125.07949d7c.js"><link rel="prefetch" href="/assets/js/126.6557ef27.js"><link rel="prefetch" href="/assets/js/127.e2c838f8.js"><link rel="prefetch" href="/assets/js/128.e876bdf8.js"><link rel="prefetch" href="/assets/js/129.0e7d15bb.js"><link rel="prefetch" href="/assets/js/13.ae62b090.js"><link rel="prefetch" href="/assets/js/130.8caf4288.js"><link rel="prefetch" href="/assets/js/131.d091a5f7.js"><link rel="prefetch" href="/assets/js/132.3af86ba2.js"><link rel="prefetch" href="/assets/js/133.9b473677.js"><link rel="prefetch" href="/assets/js/134.d09f520d.js"><link rel="prefetch" href="/assets/js/135.5094d6c6.js"><link rel="prefetch" href="/assets/js/136.f554265c.js"><link rel="prefetch" href="/assets/js/137.db8ad307.js"><link rel="prefetch" href="/assets/js/138.97a9f7dc.js"><link rel="prefetch" href="/assets/js/139.28a187da.js"><link rel="prefetch" href="/assets/js/14.7c89dfed.js"><link rel="prefetch" href="/assets/js/140.58f327a0.js"><link rel="prefetch" href="/assets/js/141.dac9c32e.js"><link rel="prefetch" href="/assets/js/142.15e4cd8a.js"><link rel="prefetch" href="/assets/js/143.29bcf51a.js"><link rel="prefetch" href="/assets/js/144.93e792a5.js"><link rel="prefetch" href="/assets/js/145.1e479d7f.js"><link rel="prefetch" href="/assets/js/146.fef6b20d.js"><link rel="prefetch" href="/assets/js/147.a8939180.js"><link rel="prefetch" href="/assets/js/148.73ab52d1.js"><link rel="prefetch" href="/assets/js/149.de7d77b9.js"><link rel="prefetch" href="/assets/js/15.4266d5a5.js"><link rel="prefetch" href="/assets/js/150.14cd4f5b.js"><link rel="prefetch" href="/assets/js/151.ae320b72.js"><link rel="prefetch" href="/assets/js/152.9f70308b.js"><link rel="prefetch" href="/assets/js/153.8bb08923.js"><link rel="prefetch" href="/assets/js/154.bef6a0fb.js"><link rel="prefetch" href="/assets/js/155.e0e21ff7.js"><link rel="prefetch" href="/assets/js/156.e212e95d.js"><link rel="prefetch" href="/assets/js/157.9af3323d.js"><link rel="prefetch" href="/assets/js/158.a6990b68.js"><link rel="prefetch" href="/assets/js/159.9921842e.js"><link rel="prefetch" href="/assets/js/16.4d11e9b4.js"><link rel="prefetch" href="/assets/js/160.cb690287.js"><link rel="prefetch" href="/assets/js/161.10ec68a7.js"><link rel="prefetch" href="/assets/js/162.5e2e8da5.js"><link rel="prefetch" href="/assets/js/163.7ad3dc89.js"><link rel="prefetch" href="/assets/js/164.0677e91f.js"><link rel="prefetch" href="/assets/js/165.eabba413.js"><link rel="prefetch" href="/assets/js/166.de181132.js"><link rel="prefetch" href="/assets/js/167.eb1f2c20.js"><link rel="prefetch" href="/assets/js/168.33870baa.js"><link rel="prefetch" href="/assets/js/169.0eb4e75c.js"><link rel="prefetch" href="/assets/js/17.2f17b760.js"><link rel="prefetch" href="/assets/js/170.6a8f837b.js"><link rel="prefetch" href="/assets/js/171.33c99890.js"><link rel="prefetch" href="/assets/js/172.e2ac6d6c.js"><link rel="prefetch" href="/assets/js/173.f37baa2e.js"><link rel="prefetch" href="/assets/js/174.3f1765d5.js"><link rel="prefetch" href="/assets/js/175.ee3e624a.js"><link rel="prefetch" href="/assets/js/176.b7c3d2ba.js"><link rel="prefetch" href="/assets/js/177.538dbd98.js"><link rel="prefetch" href="/assets/js/178.688b2ab3.js"><link rel="prefetch" href="/assets/js/179.7605eb3a.js"><link rel="prefetch" href="/assets/js/18.46454e6b.js"><link rel="prefetch" href="/assets/js/180.f734c479.js"><link rel="prefetch" href="/assets/js/181.f009bfc4.js"><link rel="prefetch" href="/assets/js/182.51a8e6fc.js"><link rel="prefetch" href="/assets/js/183.0f688ed3.js"><link rel="prefetch" href="/assets/js/184.e20ab6d5.js"><link rel="prefetch" href="/assets/js/185.336035f1.js"><link rel="prefetch" href="/assets/js/186.e7f18b72.js"><link rel="prefetch" href="/assets/js/187.20bae185.js"><link rel="prefetch" href="/assets/js/188.4d746641.js"><link rel="prefetch" href="/assets/js/189.45442618.js"><link rel="prefetch" href="/assets/js/19.07e2632b.js"><link rel="prefetch" href="/assets/js/190.6f6c4889.js"><link rel="prefetch" href="/assets/js/191.b73399a8.js"><link rel="prefetch" href="/assets/js/192.657f63ce.js"><link rel="prefetch" href="/assets/js/193.348754cf.js"><link rel="prefetch" href="/assets/js/194.7ea4e875.js"><link rel="prefetch" href="/assets/js/195.011c9aaa.js"><link rel="prefetch" href="/assets/js/196.30ca323d.js"><link rel="prefetch" href="/assets/js/197.b404290d.js"><link rel="prefetch" href="/assets/js/198.19eeb699.js"><link rel="prefetch" href="/assets/js/199.578524cd.js"><link rel="prefetch" href="/assets/js/20.e8632e9e.js"><link rel="prefetch" href="/assets/js/200.2483c16f.js"><link rel="prefetch" href="/assets/js/201.80be911a.js"><link rel="prefetch" href="/assets/js/202.6292d716.js"><link rel="prefetch" href="/assets/js/203.0423f992.js"><link rel="prefetch" href="/assets/js/204.220cf5d5.js"><link rel="prefetch" href="/assets/js/205.cf88ea69.js"><link rel="prefetch" href="/assets/js/206.7837a407.js"><link rel="prefetch" href="/assets/js/207.15eb7f61.js"><link rel="prefetch" href="/assets/js/208.c92b54ae.js"><link rel="prefetch" href="/assets/js/209.d6858997.js"><link rel="prefetch" href="/assets/js/21.9d97eca0.js"><link rel="prefetch" href="/assets/js/210.3a916b1e.js"><link rel="prefetch" href="/assets/js/211.99ca202d.js"><link rel="prefetch" href="/assets/js/212.18a13454.js"><link rel="prefetch" href="/assets/js/213.7eb5f7fd.js"><link rel="prefetch" href="/assets/js/214.178507b3.js"><link rel="prefetch" href="/assets/js/215.e9eac7bd.js"><link rel="prefetch" href="/assets/js/216.bdd656c6.js"><link rel="prefetch" href="/assets/js/217.487e6997.js"><link rel="prefetch" href="/assets/js/218.eb54add1.js"><link rel="prefetch" href="/assets/js/22.ed6e719f.js"><link rel="prefetch" href="/assets/js/220.757359d6.js"><link rel="prefetch" href="/assets/js/221.d58f156a.js"><link rel="prefetch" href="/assets/js/222.99dc1661.js"><link rel="prefetch" href="/assets/js/223.22a61d2b.js"><link rel="prefetch" href="/assets/js/224.514138b9.js"><link rel="prefetch" href="/assets/js/225.fc56b049.js"><link rel="prefetch" href="/assets/js/226.59d64fed.js"><link rel="prefetch" href="/assets/js/227.8841cf23.js"><link rel="prefetch" href="/assets/js/228.f37358c2.js"><link rel="prefetch" href="/assets/js/229.97cb9c4e.js"><link rel="prefetch" href="/assets/js/23.5eccc486.js"><link rel="prefetch" href="/assets/js/230.a16ada6a.js"><link rel="prefetch" href="/assets/js/231.5f761bf3.js"><link rel="prefetch" href="/assets/js/232.76d78495.js"><link rel="prefetch" href="/assets/js/233.162bba41.js"><link rel="prefetch" href="/assets/js/234.a845dfca.js"><link rel="prefetch" href="/assets/js/235.169ff72d.js"><link rel="prefetch" href="/assets/js/236.c50d9ecf.js"><link rel="prefetch" href="/assets/js/237.594eecee.js"><link rel="prefetch" href="/assets/js/238.b599dae8.js"><link rel="prefetch" href="/assets/js/239.7be81ebe.js"><link rel="prefetch" href="/assets/js/24.c81753d3.js"><link rel="prefetch" href="/assets/js/240.b9f18f9e.js"><link rel="prefetch" href="/assets/js/241.77d17f60.js"><link rel="prefetch" href="/assets/js/242.0894cddd.js"><link rel="prefetch" href="/assets/js/243.4c71e0af.js"><link rel="prefetch" href="/assets/js/244.47579b9c.js"><link rel="prefetch" href="/assets/js/245.29344e11.js"><link rel="prefetch" href="/assets/js/246.410a1027.js"><link rel="prefetch" href="/assets/js/247.b22fa817.js"><link rel="prefetch" href="/assets/js/25.f3141c92.js"><link rel="prefetch" href="/assets/js/26.573fd0de.js"><link rel="prefetch" href="/assets/js/27.9a72220d.js"><link rel="prefetch" href="/assets/js/28.e161668a.js"><link rel="prefetch" href="/assets/js/29.6d2ef014.js"><link rel="prefetch" href="/assets/js/30.0dd2ba52.js"><link rel="prefetch" href="/assets/js/31.e8c4ee1d.js"><link rel="prefetch" href="/assets/js/32.c57cfa4e.js"><link rel="prefetch" href="/assets/js/33.7c1ec4ff.js"><link rel="prefetch" href="/assets/js/34.110d90ae.js"><link rel="prefetch" href="/assets/js/35.c5fbf1bd.js"><link rel="prefetch" href="/assets/js/36.58d307d9.js"><link rel="prefetch" href="/assets/js/37.6e68d82d.js"><link rel="prefetch" href="/assets/js/38.0a2bfb96.js"><link rel="prefetch" href="/assets/js/39.79a25586.js"><link rel="prefetch" href="/assets/js/4.10092391.js"><link rel="prefetch" href="/assets/js/40.1b3fb2c7.js"><link rel="prefetch" href="/assets/js/41.2cd990a4.js"><link rel="prefetch" href="/assets/js/42.3803a3ba.js"><link rel="prefetch" href="/assets/js/43.56cde0b8.js"><link rel="prefetch" href="/assets/js/44.98f12e35.js"><link rel="prefetch" href="/assets/js/45.bbed8377.js"><link rel="prefetch" href="/assets/js/46.80af516b.js"><link rel="prefetch" href="/assets/js/47.bfe18f20.js"><link rel="prefetch" href="/assets/js/48.e4bead99.js"><link rel="prefetch" href="/assets/js/49.da1a7c67.js"><link rel="prefetch" href="/assets/js/5.0b5a1289.js"><link rel="prefetch" href="/assets/js/50.b6011d95.js"><link rel="prefetch" href="/assets/js/51.81adcdd5.js"><link rel="prefetch" href="/assets/js/52.b650e175.js"><link rel="prefetch" href="/assets/js/53.22c44460.js"><link rel="prefetch" href="/assets/js/54.3c9964c8.js"><link rel="prefetch" href="/assets/js/55.80bec639.js"><link rel="prefetch" href="/assets/js/56.2066f85f.js"><link rel="prefetch" href="/assets/js/57.ab6dbc19.js"><link rel="prefetch" href="/assets/js/58.6236e7f0.js"><link rel="prefetch" href="/assets/js/59.618e25d3.js"><link rel="prefetch" href="/assets/js/6.a1e90b5b.js"><link rel="prefetch" href="/assets/js/60.3deac196.js"><link rel="prefetch" href="/assets/js/61.890283e9.js"><link rel="prefetch" href="/assets/js/62.ffe465e9.js"><link rel="prefetch" href="/assets/js/63.cc9a42cc.js"><link rel="prefetch" href="/assets/js/64.c66e6c4f.js"><link rel="prefetch" href="/assets/js/65.95e3ddfd.js"><link rel="prefetch" href="/assets/js/66.256b023f.js"><link rel="prefetch" href="/assets/js/67.436df8a0.js"><link rel="prefetch" href="/assets/js/68.d532ffa8.js"><link rel="prefetch" href="/assets/js/69.963c3596.js"><link rel="prefetch" href="/assets/js/7.74944cf6.js"><link rel="prefetch" href="/assets/js/70.6dfd1704.js"><link rel="prefetch" href="/assets/js/71.53af90e0.js"><link rel="prefetch" href="/assets/js/72.580797e8.js"><link rel="prefetch" href="/assets/js/73.5c14d158.js"><link rel="prefetch" href="/assets/js/74.70cf381f.js"><link rel="prefetch" href="/assets/js/75.01dbab82.js"><link rel="prefetch" href="/assets/js/76.18b48db2.js"><link rel="prefetch" href="/assets/js/77.0fa8965d.js"><link rel="prefetch" href="/assets/js/78.bede6ca6.js"><link rel="prefetch" href="/assets/js/79.1c7c8167.js"><link rel="prefetch" href="/assets/js/8.fbc0181a.js"><link rel="prefetch" href="/assets/js/80.688d4c3b.js"><link rel="prefetch" href="/assets/js/81.4eaaee90.js"><link rel="prefetch" href="/assets/js/82.53bf5bf4.js"><link rel="prefetch" href="/assets/js/83.53cdee38.js"><link rel="prefetch" href="/assets/js/84.848d09d8.js"><link rel="prefetch" href="/assets/js/85.4ef416fa.js"><link rel="prefetch" href="/assets/js/86.559b9784.js"><link rel="prefetch" href="/assets/js/87.1317f521.js"><link rel="prefetch" href="/assets/js/88.61e1f1fa.js"><link rel="prefetch" href="/assets/js/89.c37979bc.js"><link rel="prefetch" href="/assets/js/9.acdf956e.js"><link rel="prefetch" href="/assets/js/90.329e7956.js"><link rel="prefetch" href="/assets/js/91.e9246182.js"><link rel="prefetch" href="/assets/js/92.41e1ecaf.js"><link rel="prefetch" href="/assets/js/93.6cbe0205.js"><link rel="prefetch" href="/assets/js/94.922231b5.js"><link rel="prefetch" href="/assets/js/95.23cfae7c.js"><link rel="prefetch" href="/assets/js/96.790a39b9.js"><link rel="prefetch" href="/assets/js/97.8ce2cb69.js"><link rel="prefetch" href="/assets/js/98.f016d83e.js"><link rel="prefetch" href="/assets/js/99.b1d81562.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.96cada6e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.27efc831.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/website_icon.png" alt="SAL Repo" class="logo"> <span class="site-name can-hide">SAL Repo</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><a href="/work/" class="link-title">工作</a> <span class="title" style="display:none;">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>编程语言</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/C/" class="nav-link">C</a></li><li class="dropdown-subitem"><a href="/work/C++/" class="nav-link">C++</a></li><li class="dropdown-subitem"><a href="/work/Script_Language/" class="nav-link">Script_Language</a></li></ul></li><li class="dropdown-item"><h4>计算机知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/Linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/work/dataStruct/" class="nav-link">数据机构与算法</a></li><li class="dropdown-subitem"><a href="/work/OS/" class="nav-link">操作系统</a></li><li class="dropdown-subitem"><a href="/work/network/" class="nav-link">计算机网络</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/work/Redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/Git/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/work/VM/" class="nav-link">虚拟机</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/leetcode/" class="nav-link">刷题</a></li><li class="dropdown-subitem"><a href="/work/bg/" class="nav-link">interview</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/project/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/mynetlib/" class="nav-link">mynetlib</a></li><li class="dropdown-item"><!----> <a href="/project/mymprpc/" class="nav-link">mymprpc</a></li><li class="dropdown-item"><!----> <a href="/project/mytinystl/" class="nav-link">mytinystl</a></li><li class="dropdown-item"><!----> <a href="/project/DML/" class="nav-link">DML</a></li><li class="dropdown-item"><!----> <a href="/project/FL/" class="nav-link">FL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><a href="/study/" class="link-title">学习</a> <span class="title" style="display:none;">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>研究生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/study/publications/" class="nav-link">publications</a></li><li class="dropdown-subitem"><a href="/study/ML/" class="nav-link">机器学习</a></li></ul></li><li class="dropdown-item"><h4>阅读</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/study/read/" class="nav-link">个人摘抄</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><a href="/life/" class="link-title">生活</a> <span class="title" style="display:none;">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/71024e/" class="nav-link">生活</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/collection/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>总览</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/collection/favorites/" class="nav-link">个人收藏夹</a></li><li class="dropdown-subitem"><a href="/collection/download/" class="nav-link">资源下载</a></li></ul></li><li class="dropdown-item"><h4>快速链接</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://sci-hub.wf/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  SCI-HUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/collection/favorites/#文件转换、解密工具" class="nav-link">文件转换、解密工具</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>友链</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/friends/" class="nav-link">友情链接</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/smileatl/smileatlRepository_source" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.jpg"> <div class="blogger-info"><h3>smileatl</h3> <span>smileatl, Songlei Lin</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作" class="dropdown-title"><a href="/work/" class="link-title">工作</a> <span class="title" style="display:none;">工作</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>编程语言</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/C/" class="nav-link">C</a></li><li class="dropdown-subitem"><a href="/work/C++/" class="nav-link">C++</a></li><li class="dropdown-subitem"><a href="/work/Script_Language/" class="nav-link">Script_Language</a></li></ul></li><li class="dropdown-item"><h4>计算机知识</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/Linux/" class="nav-link">Linux</a></li><li class="dropdown-subitem"><a href="/work/dataStruct/" class="nav-link">数据机构与算法</a></li><li class="dropdown-subitem"><a href="/work/OS/" class="nav-link">操作系统</a></li><li class="dropdown-subitem"><a href="/work/network/" class="nav-link">计算机网络</a></li></ul></li><li class="dropdown-item"><h4>数据库</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/MySQL/" class="nav-link">MySQL</a></li><li class="dropdown-subitem"><a href="/work/Redis/" class="nav-link">Redis</a></li></ul></li><li class="dropdown-item"><h4>工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/Git/" class="nav-link">Git</a></li><li class="dropdown-subitem"><a href="/work/VM/" class="nav-link">虚拟机</a></li></ul></li><li class="dropdown-item"><h4>其他</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/work/leetcode/" class="nav-link">刷题</a></li><li class="dropdown-subitem"><a href="/work/bg/" class="nav-link">interview</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目" class="dropdown-title"><a href="/project/" class="link-title">项目</a> <span class="title" style="display:none;">项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/mynetlib/" class="nav-link">mynetlib</a></li><li class="dropdown-item"><!----> <a href="/project/mymprpc/" class="nav-link">mymprpc</a></li><li class="dropdown-item"><!----> <a href="/project/mytinystl/" class="nav-link">mytinystl</a></li><li class="dropdown-item"><!----> <a href="/project/DML/" class="nav-link">DML</a></li><li class="dropdown-item"><!----> <a href="/project/FL/" class="nav-link">FL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习" class="dropdown-title"><a href="/study/" class="link-title">学习</a> <span class="title" style="display:none;">学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>研究生</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/study/publications/" class="nav-link">publications</a></li><li class="dropdown-subitem"><a href="/study/ML/" class="nav-link">机器学习</a></li></ul></li><li class="dropdown-item"><h4>阅读</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/study/read/" class="nav-link">个人摘抄</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><a href="/life/" class="link-title">生活</a> <span class="title" style="display:none;">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/71024e/" class="nav-link">生活</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/collection/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>总览</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/collection/favorites/" class="nav-link">个人收藏夹</a></li><li class="dropdown-subitem"><a href="/collection/download/" class="nav-link">资源下载</a></li></ul></li><li class="dropdown-item"><h4>快速链接</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://sci-hub.wf/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  SCI-HUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/collection/favorites/#文件转换、解密工具" class="nav-link">文件转换、解密工具</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>友链</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/friends/" class="nav-link">友情链接</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div> <a href="https://github.com/smileatl/smileatlRepository_source" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mynetlib</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mymprpc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mytinystl</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c12045/" class="sidebar-link">README</a></li><li><a href="/pages/f27f94/" class="sidebar-link">MyTinySTL</a></li><li><a href="/pages/e897b1/" class="sidebar-link">template</a></li><li><a href="/pages/19ed0f/" class="sidebar-link">实现顺序</a></li><li><a href="/pages/de772c/" class="sidebar-link">空间配置器allocator</a></li><li><a href="/pages/64464e/" class="sidebar-link">迭代器iterator</a></li><li><a href="/pages/ee9345/" class="sidebar-link">仿函数functional</a></li><li><a href="/pages/961e35/" aria-current="page" class="active sidebar-link">容器container</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/961e35/#mytinystl容器" class="sidebar-link">MyTinySTL容器</a></li><li class="sidebar-sub-header level2"><a href="/pages/961e35/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header level2"><a href="/pages/961e35/#序列式容器" class="sidebar-link">序列式容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/961e35/#vector" class="sidebar-link">vector</a></li><li class="sidebar-sub-header level3"><a href="/pages/961e35/#list" class="sidebar-link">list</a></li><li class="sidebar-sub-header level3"><a href="/pages/961e35/#deque" class="sidebar-link">deque</a></li><li class="sidebar-sub-header level3"><a href="/pages/961e35/#stack和queue" class="sidebar-link">stack和queue</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/961e35/#关联式容器" class="sidebar-link">关联式容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/961e35/#rb-tree" class="sidebar-link">RB-tree</a></li><li class="sidebar-sub-header level4"><a href="/pages/961e35/#为什么用红黑树" class="sidebar-link">为什么用红黑树</a></li><li class="sidebar-sub-header level4"><a href="/pages/961e35/#实现" class="sidebar-link">实现</a></li><li class="sidebar-sub-header level3"><a href="/pages/961e35/#set、multiset、map和multimap" class="sidebar-link">set、multiset、map和multimap</a></li><li class="sidebar-sub-header level3"><a href="/pages/961e35/#hashtable" class="sidebar-link">hashtable</a></li><li class="sidebar-sub-header level4"><a href="/pages/961e35/#常用hash函数" class="sidebar-link">常用Hash函数</a></li><li class="sidebar-sub-header level4"><a href="/pages/961e35/#冲突处理" class="sidebar-link">冲突处理</a></li><li class="sidebar-sub-header level4"><a href="/pages/961e35/#设计" class="sidebar-link">设计</a></li><li class="sidebar-sub-header level3"><a href="/pages/961e35/#unordered-set、unordered-multiset、unordered-map和unordered-multimap" class="sidebar-link">unordered_set、unordered_multiset、unordered_map和unordered_multimap</a></li></ul></li></ul></li><li><a href="/pages/c46ee9/" class="sidebar-link">算法algorithm</a></li><li><a href="/pages/7faaef/" class="sidebar-link">适配器adapter</a></li><li><a href="/pages/c4cc1c/" class="sidebar-link">测试</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FL</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/project/#项目" data-v-06225672>项目</a></li><li data-v-06225672><a href="/project/#mytinystl" data-v-06225672>mytinystl</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/smileatl" target="_blank" title="作者" class="beLink" data-v-06225672>smileatl</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-08-11</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">容器container<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="容器"><a href="#容器" class="header-anchor">#</a> 容器</h1> <h2 id="mytinystl容器"><a href="#mytinystl容器" class="header-anchor">#</a> MyTinySTL容器</h2> <p>容器的内容很多，我只挑选我觉得比较重要的部分讲解，很多都可以从代码中了解。</p> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>分类：</p> <ul><li>序列容器</li></ul> <p><img src="/assets/20210318140952743.png" alt="在这里插入图片描述"></p> <ul><li>关联容器</li></ul> <p><img src="/assets/2021031814100995.png" alt="在这里插入图片描述"></p> <h2 id="序列式容器"><a href="#序列式容器" class="header-anchor">#</a> 序列式容器</h2> <h3 id="vector"><a href="#vector" class="header-anchor">#</a> vector</h3> <p>首先可以看到<code>vector</code>定义了嵌套型别( 规则要求每个使用traits萃取器的都必须自己定义五个嵌套型别 )。<br> <code>vector</code>的迭代器就是一个普通指针，也就可以做很多内存方面的优化了。<br> <code>vector</code>的内存必须是一整段连续的内存空间，由三个指针指出，分别指向使用空间的头尾和可用空间的尾部。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">vector</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static_assert</span><span class="token punctuation">(</span><span class="token operator">!</span>std<span class="token double-colon punctuation">::</span>is_same<span class="token operator">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">,</span> T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;vector&lt;bool&gt; is abandoned in mystl&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      allocator_type<span class="token punctuation">;</span>	<span class="token comment">/*! 分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      data_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 分配器 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>value_type      value_type<span class="token punctuation">;</span>		<span class="token comment">/*! 数据类型 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>pointer         pointer<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_pointer   const_pointer<span class="token punctuation">;</span>		<span class="token comment">/*! const数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>reference       reference<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_reference const_reference<span class="token punctuation">;</span>	<span class="token comment">/*! const数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>size_type       size_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型大小 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>difference_type difference_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据类型指针距离 */</span>

	<span class="token keyword">typedef</span> value_type<span class="token operator">*</span>                              iterator<span class="token punctuation">;</span>					<span class="token comment">/*! 迭代器（这里就是指针） */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">const</span> value_type<span class="token operator">*</span>                        const_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! const迭代器（这里就是const指针） */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>iterator<span class="token operator">&gt;</span>        reverse_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! 反向迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>const_iterator<span class="token operator">&gt;</span>  const_reverse_iterator<span class="token punctuation">;</span>	<span class="token comment">/*! 反向const迭代器 */</span>

	<span class="token comment">/*! 获取分配器 */</span>
	allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">data_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	iterator begin_<span class="token punctuation">;</span>  <span class="token comment">/*! 表示目前使用空间的头部 */</span>
	iterator end_<span class="token punctuation">;</span>    <span class="token comment">/*! 表示目前使用空间的尾部 */</span>
	iterator cap_<span class="token punctuation">;</span>    <span class="token comment">/*! 表示目前储存空间的尾部 */</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>对于<code>vector</code>来说最重要的就是了解如何动态增长的。<br>
首先我创建一个<code>vector</code>对象，调用了最基础的构造函数，可以发现直接给我们分配了16内存大小（注意不是16个字节，下面说的大小的单位都是存储对象<code>T</code>大小）。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">vector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
<span class="token punctuation">{</span>
	<span class="token function">try_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 固定分配16个元素内存 若分配失败则忽略，不抛出异常 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">try_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
<span class="token punctuation">{</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		begin_ <span class="token operator">=</span> data_allocator<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		end_ <span class="token operator">=</span> begin_<span class="token punctuation">;</span>
		cap_ <span class="token operator">=</span> begin_ <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		begin_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		end_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		cap_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>接下来就是调用<code>push_back</code>在尾部插入元素，如果还有容量就很好，如果没有多余容量就需要扩容。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>end_ <span class="token operator">!=</span> cap_<span class="token punctuation">)</span>	<span class="token comment">// 还有多余容量</span>
	<span class="token punctuation">{</span>
        <span class="token comment">// 在指定的内存地址构造对象，也就是_end处</span>
		data_allocator<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">address_of</span><span class="token punctuation">(</span><span class="token operator">*</span>end_<span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">++</span>end_<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token comment">// 没有多余容量</span>
	<span class="token punctuation">{</span>
		<span class="token function">reallocate_insert</span><span class="token punctuation">(</span>end_<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><code>reallocate_insert</code>会重新分配空间并在 pos 处插入元素。
首先这边调用了<code>get_new_cap</code>来得到我们要扩容到多大。（扩容机制可以看下面代码注释，简单来说就是1.5倍扩容）
然后直接分配内存，将老的内容move过去，在 pos 处构造出元素，然后释放以前的内存。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">reallocate_insert</span><span class="token punctuation">(</span>iterator pos<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> new_size <span class="token operator">=</span> <span class="token function">get_new_cap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> new_begin <span class="token operator">=</span> data_allocator<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span>new_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> new_end <span class="token operator">=</span> new_begin<span class="token punctuation">;</span>
	<span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value_copy <span class="token operator">=</span> value<span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		new_end <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">uninitialized_move</span><span class="token punctuation">(</span>begin_<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> new_begin<span class="token punctuation">)</span><span class="token punctuation">;</span>
		data_allocator<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">address_of</span><span class="token punctuation">(</span><span class="token operator">*</span>new_end<span class="token punctuation">)</span><span class="token punctuation">,</span> value_copy<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">++</span>new_end<span class="token punctuation">;</span>
		new_end <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">uninitialized_move</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> end_<span class="token punctuation">,</span> new_end<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		data_allocator<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>new_begin<span class="token punctuation">,</span> new_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">destroy_and_recover</span><span class="token punctuation">(</span>begin_<span class="token punctuation">,</span> end_<span class="token punctuation">,</span> cap_ <span class="token operator">-</span> begin_<span class="token punctuation">)</span><span class="token punctuation">;</span>
	begin_ <span class="token operator">=</span> new_begin<span class="token punctuation">;</span>
	end_ <span class="token operator">=</span> new_end<span class="token punctuation">;</span>
	cap_ <span class="token operator">=</span> new_begin <span class="token operator">+</span> new_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 获取能增加的容量 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>size_type <span class="token class-name">vector</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">get_new_cap</span><span class="token punctuation">(</span>size_type add_size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// 得到现有容量大小</span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> old_size <span class="token operator">=</span> <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 如果现有容量+要增加的容量 大于 最大容量 直接异常</span>
	<span class="token function">THROW_LENGTH_ERROR_IF</span><span class="token punctuation">(</span>old_size <span class="token operator">&gt;</span> <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> add_size<span class="token punctuation">,</span> <span class="token string">&quot;vector&lt;T&gt;'s size too big&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 如果现有容量的1.5倍 大于 最大容量</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>old_size <span class="token operator">&gt;</span> <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> old_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">// 如果 现有容量 + 要增加的容量 + 16 大于 最大容量</span>
		<span class="token comment">// 则返回 现有容量 + 要增加的容量</span>
		<span class="token comment">// 否则返回 现有容量 + 要增加的容量 + 16</span>
		<span class="token keyword">return</span> old_size <span class="token operator">+</span> add_size <span class="token operator">&gt;</span> <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">16</span>
			<span class="token operator">?</span> old_size <span class="token operator">+</span> add_size <span class="token operator">:</span> old_size <span class="token operator">+</span> add_size <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 如果现有容量为0</span>
	<span class="token comment">// 则返回 要增加的容量 和 16 比较大的</span>
	<span class="token comment">// 否则返回 现有容量1.5倍 和 现有容量+要增加的容量 比较大的</span>
	<span class="token keyword">const</span> size_type new_size <span class="token operator">=</span> old_size <span class="token operator">==</span> <span class="token number">0</span>
		<span class="token operator">?</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>add_size<span class="token punctuation">,</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token operator">:</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>old_size <span class="token operator">+</span> old_size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> old_size <span class="token operator">+</span> add_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> new_size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>这边的move最后会调用移动构造函数，这样移动的效率会很高。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// 这是一个移动构造函数，用于将一个右值引用的 `vector`对象的资源（即存储空间）移动到当前的对象中。</span>
<span class="token comment">// 在移动构造函数中，我们首先将右值引用的对象的成员变量 `begin_`、`end_` 和 `cap_`（即指向存储空间的指针）赋值给当前对象的相应成员变量。</span>
<span class="token comment">// 由于移动构造函数的语义是“窃取”右值引用对象的资源，因此在赋值后，我们需要将右值引用对象的成员变量设置为 `nullptr`，以避免在其析构函数中释放已经移动的资源。</span>
<span class="token comment">// 需要注意的是，移动构造函数应该是 `noexcept` 的，以便在使用容器类时进行优化。因为 `noexcept` 保证了在移动构造函数中不会发生异常抛出，这使得编译器可以在某些情况下对代码进行优化，提高程序的性能</span>
<span class="token function">vector</span><span class="token punctuation">(</span>vector<span class="token operator">&amp;&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
	<span class="token operator">:</span><span class="token function">begin_</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>begin_<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">end_</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>end_<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">cap_</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>cap_<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	rhs<span class="token punctuation">.</span>begin_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	rhs<span class="token punctuation">.</span>end_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	rhs<span class="token punctuation">.</span>cap_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果在中间插入元素就需要移动元素后所有的元素，注意不要元素覆盖就好，还是很简单的。</p> <h3 id="list"><a href="#list" class="header-anchor">#</a> list</h3> <p>这边实现了一个双向循环链表，优缺点大家都很清楚。<br>
首先看节点分成数据节点和基本节点，是一个继承关系，个人感觉搞的有点复杂了。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/*! list 基本节点 用来连接前后节点的 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">list_node_base</span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>base_ptr base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>node_ptr node_ptr<span class="token punctuation">;</span>

	base_ptr prev<span class="token punctuation">;</span>  <span class="token comment">/*! 前一节点 */</span>
	base_ptr next<span class="token punctuation">;</span>  <span class="token comment">/*! 下一节点 */</span>

	<span class="token function">list_node_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

	node_ptr <span class="token function">as_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>node_ptr<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		prev <span class="token operator">=</span> next <span class="token operator">=</span> <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	base_ptr <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>base_ptr<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*! list 数据节点 用来保存数据的 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">list_node</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">list_node_base</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>base_ptr base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>node_ptr node_ptr<span class="token punctuation">;</span>

	T value<span class="token punctuation">;</span>  <span class="token comment">/*! 数据域 */</span>

	<span class="token function">list_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
	<span class="token function">list_node</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">value</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token function">list_node</span><span class="token punctuation">(</span>T<span class="token operator">&amp;&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">value</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	base_ptr <span class="token function">as_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>base_ptr<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	node_ptr <span class="token function">self</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>node_ptr<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>有两个节点类型就需要个萃取机</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">node_traits</span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> list_node_base<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> list_node<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span>      node_ptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>list的迭代器和vector不一样，vector是一个指针，list需要自己设计了。<br>
这边继承了一个双向迭代器，重载了许多运算符让它的行为像一个指针，但是不能像指针一样随机访问。<br>
还有一个const版本的代码就不贴了。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">list_iterator</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> mystl<span class="token double-colon punctuation">::</span><span class="token class-name">iterator</span><span class="token operator">&lt;</span>mystl<span class="token double-colon punctuation">::</span><span class="token class-name">bidirectional_iterator_tag</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> T                                 value_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> T<span class="token operator">*</span>                                pointer<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> T<span class="token operator">&amp;</span>                                reference<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>base_ptr base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>node_ptr node_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> list_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                  self<span class="token punctuation">;</span>

	base_ptr node_<span class="token punctuation">;</span>  <span class="token comment">/*! 指向当前节点 */</span>

	<span class="token comment">/*! 构造函数 */</span>
	<span class="token function">list_iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
	<span class="token function">list_iterator</span><span class="token punctuation">(</span>base_ptr x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">node_</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token function">list_iterator</span><span class="token punctuation">(</span>node_ptr x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">node_</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span><span class="token function">as_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token function">list_iterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> list_iterator<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">node_</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>node_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token comment">/*! 重载操作符 */</span>
	reference <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node_<span class="token operator">-&gt;</span><span class="token function">as_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
	pointer   <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">MYSTL_DEBUG</span><span class="token punctuation">(</span>node_ <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		node_ <span class="token operator">=</span> node_<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	self <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		self tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token operator">++</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">MYSTL_DEBUG</span><span class="token punctuation">(</span>node_ <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		node_ <span class="token operator">=</span> node_<span class="token operator">-&gt;</span>prev<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	self <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		self tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token operator">--</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/*! 重载比较操作符 */</span>
	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node_ <span class="token operator">==</span> rhs<span class="token punctuation">.</span>node_<span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node_ <span class="token operator">!=</span> rhs<span class="token punctuation">.</span>node_<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p><code>list</code>定义了嵌套型别，并且有一个指向末尾的节点，和节点大小。<br>
因为是双向循环链表，所以指向末尾的节点很容易就得到头结点。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">list</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      allocator_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      data_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>list_node_base<span class="token operator">&lt;</span>T<span class="token operator">&gt;&gt;</span>      base_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 基本节点分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>list_node<span class="token operator">&lt;</span>T<span class="token operator">&gt;&gt;</span>           node_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 数据节点分配器 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>value_type      value_type<span class="token punctuation">;</span>		<span class="token comment">/*! 数据类型 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>pointer         pointer<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_pointer   const_pointer<span class="token punctuation">;</span>		<span class="token comment">/*! const数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>reference       reference<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_reference const_reference<span class="token punctuation">;</span>	<span class="token comment">/*! const数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>size_type       size_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型大小 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>difference_type difference_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据类型指针距离 */</span>

	<span class="token keyword">typedef</span> list_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                         iterator<span class="token punctuation">;</span>					<span class="token comment">/*! 迭代器（这里就是结构体） */</span>
	<span class="token keyword">typedef</span> list_const_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                   const_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! const迭代器（这里就是const结构体） */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>iterator<span class="token operator">&gt;</span>        reverse_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! 反向迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>const_iterator<span class="token operator">&gt;</span>  const_reverse_iterator<span class="token punctuation">;</span>	<span class="token comment">/*! 反向const迭代器 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>base_ptr        base_ptr<span class="token punctuation">;</span>	<span class="token comment">/*! 基本节点指针类型 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">node_traits</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>node_ptr        node_ptr<span class="token punctuation">;</span>	<span class="token comment">/*! 数据节点指针类型 */</span>

	allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">node_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	base_ptr  node_<span class="token punctuation">;</span>  <span class="token comment">/*! 指向末尾节点 */</span>
	size_type size_<span class="token punctuation">;</span>  <span class="token comment">/*! 大小 */</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>链表的操作主要记住先连后断就好</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/*! 在头部连接 [first, last] 结点 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">link_nodes_at_front</span><span class="token punctuation">(</span>base_ptr first<span class="token punctuation">,</span> base_ptr last<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	first<span class="token operator">-&gt;</span>prev <span class="token operator">=</span> node_<span class="token punctuation">;</span>
	last<span class="token operator">-&gt;</span>next <span class="token operator">=</span> node_<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
	last<span class="token operator">-&gt;</span>next<span class="token operator">-&gt;</span>prev <span class="token operator">=</span> last<span class="token punctuation">;</span>
	node_<span class="token operator">-&gt;</span>next <span class="token operator">=</span> first<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 在尾部连接 [first, last] 结点 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">list</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">link_nodes_at_back</span><span class="token punctuation">(</span>base_ptr first<span class="token punctuation">,</span> base_ptr last<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	last<span class="token operator">-&gt;</span>next <span class="token operator">=</span> node_<span class="token punctuation">;</span>
	first<span class="token operator">-&gt;</span>prev <span class="token operator">=</span> node_<span class="token operator">-&gt;</span>prev<span class="token punctuation">;</span>
	first<span class="token operator">-&gt;</span>prev<span class="token operator">-&gt;</span>next <span class="token operator">=</span> first<span class="token punctuation">;</span>
	node_<span class="token operator">-&gt;</span>prev <span class="token operator">=</span> last<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="deque"><a href="#deque" class="header-anchor">#</a> deque</h3> <p>双端队列比<code>vector</code>和<code>list</code>都要复杂，我们先看一下它长什么样子。<br> <img src="/assets/09ca9e66c93c4682bb2a377100c64cad.png" alt="在这里插入图片描述"><br>
乍一看好像很复杂，但是它可以做到头尾插入和删除都是O(1)的时间复杂度, 空间也是可扩展的, 不会经常寻找新的空间。<br>
首先我们看到<code>map</code>指向一个<strong>指针数组</strong>，这边有八个指针可以指向八个小区域，也就是说理论上我们通过八个指针把八个不同的区块连成一个大的区块了（物理上还是分开的）。<br>
这样我们扩展的时候只要扩展<code>map</code>数组，代价很小。</p> <p>看一下迭代器的设计，一个小区块的大小由<code>deque_buf_size</code>指出，根据元素大小决定。<br>
有四个数据成员，结合上面图理解一下，分别指向当前元素，当前元素所在缓冲区的头尾以及在map中的位置。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">deque_buf_size</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">constexpr</span> size_t value <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">256</span> <span class="token operator">?</span> <span class="token number">4096</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">deque_iterator</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">iterator</span><span class="token operator">&lt;</span><span class="token class-name">random_access_iterator_tag</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> deque_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span>             iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> deque_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> deque_iterator                        self<span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> T            value_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> Ptr          pointer<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> Ref          reference<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> size_t       size_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> ptrdiff_t    difference_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> T<span class="token operator">*</span>           value_pointer<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> T<span class="token operator">*</span><span class="token operator">*</span>          map_pointer<span class="token punctuation">;</span>

	<span class="token keyword">static</span> <span class="token keyword">const</span> size_type buffer_size <span class="token operator">=</span> deque_buf_size<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">;</span>

	<span class="token comment">/*! 迭代器所含成员数据 */</span>
	value_pointer cur<span class="token punctuation">;</span>    <span class="token comment">/*! 指向所在缓冲区的当前元素 */</span>
	value_pointer first<span class="token punctuation">;</span>  <span class="token comment">/*! 指向所在缓冲区的头部 */</span>
	value_pointer last<span class="token punctuation">;</span>   <span class="token comment">/*! 指向所在缓冲区的尾部 */</span>
	map_pointer   node<span class="token punctuation">;</span>   <span class="token comment">/*! 缓冲区所在节点 */</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>继承了随机访问迭代器，需要让迭代器的行为像指针一样。<br>
这边可以做指针相减的操作，先算出map中的距离，再加上区块中的距离。<br>
移动迭代器可能会跨越区块，但是无需遍历过去，只需要计算出在哪个区块就好。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">deque_iterator</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">iterator</span><span class="token operator">&lt;</span><span class="token class-name">random_access_iterator_tag</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	。。。
	<span class="token comment">/*! 转到另一个缓冲区 */</span>
	<span class="token keyword">void</span> <span class="token function">set_node</span><span class="token punctuation">(</span>map_pointer new_node<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		node <span class="token operator">=</span> new_node<span class="token punctuation">;</span>
		first <span class="token operator">=</span> <span class="token operator">*</span>new_node<span class="token punctuation">;</span>
		last <span class="token operator">=</span> first <span class="token operator">+</span> buffer_size<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	reference <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">*</span>cur<span class="token punctuation">;</span> <span class="token punctuation">}</span>
	pointer   <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> cur<span class="token punctuation">;</span> <span class="token punctuation">}</span>

	difference_type <span class="token keyword">operator</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> x<span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{</span>
		<span class="token comment">// 距离：map间的距离 + buf间的距离</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>difference_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>node <span class="token operator">-</span> x<span class="token punctuation">.</span>node<span class="token punctuation">)</span>
			<span class="token operator">+</span> <span class="token punctuation">(</span>cur <span class="token operator">-</span> first<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>cur <span class="token operator">-</span> x<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">++</span>cur<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> last<span class="token punctuation">)</span> <span class="token comment">// 如果到达缓冲区的尾</span>
		<span class="token punctuation">{</span>
			<span class="token function">set_node</span><span class="token punctuation">(</span>node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cur <span class="token operator">=</span> first<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	。。。
	self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">+=</span><span class="token punctuation">(</span>difference_type n<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">const</span> <span class="token keyword">auto</span> offset <span class="token operator">=</span> n <span class="token operator">+</span> <span class="token punctuation">(</span>cur <span class="token operator">-</span> first<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> offset <span class="token operator">&lt;</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>difference_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 仍在当前缓冲区</span>
		<span class="token punctuation">{</span>
			cur <span class="token operator">+=</span> n<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token comment">// 要跳到其他的缓冲区</span>
		<span class="token punctuation">{</span> 
			<span class="token keyword">const</span> <span class="token keyword">auto</span> node_offset <span class="token operator">=</span> offset <span class="token operator">&gt;</span> <span class="token number">0</span>
				<span class="token operator">?</span> offset <span class="token operator">/</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>difference_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span>
				<span class="token operator">:</span> <span class="token operator">-</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>difference_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>offset <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> buffer_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token function">set_node</span><span class="token punctuation">(</span>node <span class="token operator">+</span> node_offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
			cur <span class="token operator">=</span> first <span class="token operator">+</span> <span class="token punctuation">(</span>offset <span class="token operator">-</span> node_offset <span class="token operator">*</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>difference_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p><code>deque</code>定义了嵌套型别，拥有<code>map_</code>指向一个指针数组，指针数组的大小和使用了的元素的头尾。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">deque</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      allocator_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      data_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">*</span><span class="token operator">&gt;</span>                     map_allocator<span class="token punctuation">;</span>		<span class="token comment">/*! map节点分配器 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>value_type      value_type<span class="token punctuation">;</span>		<span class="token comment">/*! 数据类型 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>pointer         pointer<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_pointer   const_pointer<span class="token punctuation">;</span>		<span class="token comment">/*! const数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>reference       reference<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_reference const_reference<span class="token punctuation">;</span>	<span class="token comment">/*! const数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>size_type       size_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型大小 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>difference_type difference_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据类型指针距离 */</span>
	<span class="token keyword">typedef</span> pointer<span class="token operator">*</span>                                 map_pointer<span class="token punctuation">;</span>		<span class="token comment">/*! map节点类型指针 */</span>
	<span class="token keyword">typedef</span> const_pointer<span class="token operator">*</span>                           const_map_pointer<span class="token punctuation">;</span>	<span class="token comment">/*! constmap节点类型指针 */</span>

	<span class="token keyword">typedef</span> deque_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span>                iterator<span class="token punctuation">;</span>					<span class="token comment">/*! 迭代器 */</span>
	<span class="token keyword">typedef</span> deque_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span>    const_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! const迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>iterator<span class="token operator">&gt;</span>        reverse_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! 反向迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>const_iterator<span class="token operator">&gt;</span>  const_reverse_iterator<span class="token punctuation">;</span>	<span class="token comment">/*! 反向const迭代器 */</span>

	<span class="token comment">/*! 获取分配器 */</span>
	allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">allocator_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token keyword">static</span> <span class="token keyword">const</span> size_type buffer_size <span class="token operator">=</span> deque_buf_size<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">/*! 用以下四个数据来表现一个 deque */</span>
	iterator       begin_<span class="token punctuation">;</span>     <span class="token comment">/*! 指向第一个节点 */</span>
	iterator       end_<span class="token punctuation">;</span>       <span class="token comment">/*! 指向最后一个结点 */</span>
	map_pointer    map_<span class="token punctuation">;</span>       <span class="token comment">/*! 指向一块 map，map 中的每个元素都是一个指针，指向一个缓冲区 */</span>
	size_type      map_size_<span class="token punctuation">;</span>  <span class="token comment">/*! map 内指针的数目 */</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>老规矩，来看看如何动态增长的。<br>
初始化n个值为value的数据，先调用<code>map_init</code>分配空间，这个时候<code>begin_</code>和<code>end_</code>就指向了分配空间的头和尾（不是所有的空间，是已经使用的空间），然后填充数据。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token function">deque</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">fill_init</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">fill_init</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">map_init</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> cur <span class="token operator">=</span> begin_<span class="token punctuation">.</span>node<span class="token punctuation">;</span> cur <span class="token operator">&lt;</span> end_<span class="token punctuation">.</span>node<span class="token punctuation">;</span> <span class="token operator">++</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			mystl<span class="token double-colon punctuation">::</span><span class="token function">uninitialized_fill</span><span class="token punctuation">(</span><span class="token operator">*</span>cur<span class="token punctuation">,</span> <span class="token operator">*</span>cur <span class="token operator">+</span> buffer_size<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mystl<span class="token double-colon punctuation">::</span><span class="token function">uninitialized_fill</span><span class="token punctuation">(</span>end_<span class="token punctuation">.</span>first<span class="token punctuation">,</span> end_<span class="token punctuation">.</span>cur<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>分配空间的时候需要头尾都留出点空间来增长，数据都集中在中央。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">map_init</span><span class="token punctuation">(</span>size_type nElem<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> size_type nNode <span class="token operator">=</span> nElem <span class="token operator">/</span> buffer_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 需要分配的缓冲区个数</span>
	map_size_ <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>DEQUE_MAP_INIT_SIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> nNode <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 需要头尾空出空间来增长</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		map_ <span class="token operator">=</span> <span class="token function">create_map</span><span class="token punctuation">(</span>map_size_<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		map_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		map_size_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 让 nstart 和 nfinish 都指向 map_ 最中央的区域，方便向头尾扩充</span>
	map_pointer nstart <span class="token operator">=</span> map_ <span class="token operator">+</span> <span class="token punctuation">(</span>map_size_ <span class="token operator">-</span> nNode<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	map_pointer nfinish <span class="token operator">=</span> nstart <span class="token operator">+</span> nNode <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		<span class="token function">create_buffer</span><span class="token punctuation">(</span>nstart<span class="token punctuation">,</span> nfinish<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		map_allocator<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>map_<span class="token punctuation">,</span> map_size_<span class="token punctuation">)</span><span class="token punctuation">;</span>
		map_ <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		map_size_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	begin_<span class="token punctuation">.</span><span class="token function">set_node</span><span class="token punctuation">(</span>nstart<span class="token punctuation">)</span><span class="token punctuation">;</span>
	end_<span class="token punctuation">.</span><span class="token function">set_node</span><span class="token punctuation">(</span>nfinish<span class="token punctuation">)</span><span class="token punctuation">;</span>
	begin_<span class="token punctuation">.</span>cur <span class="token operator">=</span> begin_<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
	end_<span class="token punctuation">.</span>cur <span class="token operator">=</span> end_<span class="token punctuation">.</span>first <span class="token operator">+</span> <span class="token punctuation">(</span>nElem <span class="token operator">%</span> buffer_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>map_pointer <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">create_map</span><span class="token punctuation">(</span>size_type size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	map_pointer mp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	mp <span class="token operator">=</span> map_allocator<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>size_type i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">*</span><span class="token punctuation">(</span>mp <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> mp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">create_buffer</span><span class="token punctuation">(</span>map_pointer nstart<span class="token punctuation">,</span> map_pointer nfinish<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	map_pointer cur<span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>cur <span class="token operator">=</span> nstart<span class="token punctuation">;</span> cur <span class="token operator">&lt;=</span> nfinish<span class="token punctuation">;</span> <span class="token operator">++</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token operator">*</span>cur <span class="token operator">=</span> data_allocator<span class="token double-colon punctuation">::</span><span class="token function">allocate</span><span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">!=</span> nstart<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token operator">--</span>cur<span class="token punctuation">;</span>
			data_allocator<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span><span class="token operator">*</span>cur<span class="token punctuation">,</span> buffer_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token operator">*</span>cur <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">throw</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>再看一下在头部插入，如果当前小区域还有空间，直接就构造元素，否则会调用<code>require_capacity</code>开确保容量。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">push_front</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>cur <span class="token operator">!=</span> begin_<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		data_allocator<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>cur <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token operator">--</span>begin_<span class="token punctuation">.</span>cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token function">require_capacity</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span>
		<span class="token punctuation">{</span>
			<span class="token operator">--</span>begin_<span class="token punctuation">;</span>
			data_allocator<span class="token double-colon punctuation">::</span><span class="token function">construct</span><span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>cur<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token operator">++</span>begin_<span class="token punctuation">;</span>
			<span class="token keyword">throw</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>可以看到容量不够，就会扩展<code>map_</code>数组，代价非常小。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/*! 确保还有剩余容量 front变量判断是否在前端插入 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">require_capacity</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">,</span> <span class="token keyword">bool</span> front<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>front <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>cur <span class="token operator">-</span> begin_<span class="token punctuation">.</span>first<span class="token punctuation">)</span> <span class="token operator">&lt;</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">const</span> size_type need_buffer <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>cur <span class="token operator">-</span> begin_<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> buffer_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>need_buffer <span class="token operator">&gt;</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>node <span class="token operator">-</span> map_<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">reallocate_map_at_front</span><span class="token punctuation">(</span>need_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">create_buffer</span><span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>node <span class="token operator">-</span> need_buffer<span class="token punctuation">,</span> begin_<span class="token punctuation">.</span>node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>front <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>end_<span class="token punctuation">.</span>last <span class="token operator">-</span> end_<span class="token punctuation">.</span>cur <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">const</span> size_type need_buffer <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token punctuation">(</span>end_<span class="token punctuation">.</span>last <span class="token operator">-</span> end_<span class="token punctuation">.</span>cur <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> buffer_size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>need_buffer <span class="token operator">&gt;</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>size_type<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>map_ <span class="token operator">+</span> map_size_<span class="token punctuation">)</span> <span class="token operator">-</span> end_<span class="token punctuation">.</span>node <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">reallocate_map_at_back</span><span class="token punctuation">(</span>need_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">create_buffer</span><span class="token punctuation">(</span>end_<span class="token punctuation">.</span>node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> end_<span class="token punctuation">.</span>node <span class="token operator">+</span> need_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 在前端再分配更大的空间 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">deque</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">reallocate_map_at_front</span><span class="token punctuation">(</span>size_type need_buffer<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> size_type new_map_size <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span>map_size_ <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> map_size_ <span class="token operator">+</span> need_buffer <span class="token operator">+</span> DEQUE_MAP_INIT_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	map_pointer new_map <span class="token operator">=</span> <span class="token function">create_map</span><span class="token punctuation">(</span>new_map_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> size_type old_buffer <span class="token operator">=</span> end_<span class="token punctuation">.</span>node <span class="token operator">-</span> begin_<span class="token punctuation">.</span>node <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> size_type new_buffer <span class="token operator">=</span> old_buffer <span class="token operator">+</span> need_buffer<span class="token punctuation">;</span>

	<span class="token comment">// 另新的 map 中的指针指向原来的 buffer，并开辟新的 buffer</span>
	<span class="token keyword">auto</span> begin <span class="token operator">=</span> new_map <span class="token operator">+</span> <span class="token punctuation">(</span>new_map_size <span class="token operator">-</span> new_buffer<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> mid <span class="token operator">=</span> begin <span class="token operator">+</span> need_buffer<span class="token punctuation">;</span>
	<span class="token keyword">auto</span> end <span class="token operator">=</span> mid <span class="token operator">+</span> old_buffer<span class="token punctuation">;</span>
	<span class="token function">create_buffer</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> begin1 <span class="token operator">=</span> mid<span class="token punctuation">,</span> begin2 <span class="token operator">=</span> begin_<span class="token punctuation">.</span>node<span class="token punctuation">;</span> begin1 <span class="token operator">!=</span> end<span class="token punctuation">;</span> <span class="token operator">++</span>begin1<span class="token punctuation">,</span> <span class="token operator">++</span>begin2<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token operator">*</span>begin1 <span class="token operator">=</span> <span class="token operator">*</span>begin2<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 更新数据</span>
	map_allocator<span class="token double-colon punctuation">::</span><span class="token function">deallocate</span><span class="token punctuation">(</span>map_<span class="token punctuation">,</span> map_size_<span class="token punctuation">)</span><span class="token punctuation">;</span>
	map_ <span class="token operator">=</span> new_map<span class="token punctuation">;</span>
	map_size_ <span class="token operator">=</span> new_map_size<span class="token punctuation">;</span>
	begin_ <span class="token operator">=</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token operator">*</span>mid <span class="token operator">+</span> <span class="token punctuation">(</span>begin_<span class="token punctuation">.</span>cur <span class="token operator">-</span> begin_<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	end_ <span class="token operator">=</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end_<span class="token punctuation">.</span>cur <span class="token operator">-</span> end_<span class="token punctuation">.</span>first<span class="token punctuation">)</span><span class="token punctuation">,</span> end <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>如果使用insert在中间插入元素，就需要看是靠近前面近一点，还是靠近后面近一点，然后移动在那之前后之后的所有元素，注意不要覆盖元素就好。</p> <h3 id="stack和queue"><a href="#stack和queue" class="header-anchor">#</a> stack和queue</h3> <p>栈和队列都是配接器，内部会聚集一个底层容器，通过改变接口来修改容器的表现形式。<br>
缺省使用 mystl::deque 作为底层容器。<br>
可以发现stack并没有自己实现什么功能，全都是使用的容器<code>c_</code>的功能。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span>deque<span class="token operator">&lt;</span>T<span class="token operator">&gt;&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">stack</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> Container                           container_type<span class="token punctuation">;</span>		<span class="token comment">/*! 容器类型 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">Container</span><span class="token double-colon punctuation">::</span>value_type      value_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">Container</span><span class="token double-colon punctuation">::</span>size_type       size_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型大小 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">Container</span><span class="token double-colon punctuation">::</span>reference       reference<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">Container</span><span class="token double-colon punctuation">::</span>const_reference const_reference<span class="token punctuation">;</span>	<span class="token comment">/*! const数据类型引用 */</span>

	<span class="token keyword">static_assert</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_same<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> value_type<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">,</span> <span class="token string">&quot;the value_type of Container should be same with T&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	container_type c_<span class="token punctuation">;</span>  <span class="token comment">/*! 用底层容器表现 stack */</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">/*! 构造、复制、移动函数 */</span>
	<span class="token function">stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

	<span class="token keyword">explicit</span> <span class="token function">stack</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token function">stack</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">IIter</span><span class="token operator">&gt;</span>
	<span class="token function">stack</span><span class="token punctuation">(</span>IIter first<span class="token punctuation">,</span> IIter last<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> last<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token function">stack</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>initializer_list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> ilist<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>ilist<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ilist<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token function">stack</span><span class="token punctuation">(</span><span class="token keyword">const</span> Container<span class="token operator">&amp;</span> c<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token function">stack</span><span class="token punctuation">(</span>Container<span class="token operator">&amp;&amp;</span> c<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_nothrow_move_constructible<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token function">stack</span><span class="token punctuation">(</span><span class="token keyword">const</span> stack<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>c_<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token function">stack</span><span class="token punctuation">(</span>stack<span class="token operator">&amp;&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_nothrow_move_constructible<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">c_</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>c_<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	stack<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> stack<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_ <span class="token operator">=</span> rhs<span class="token punctuation">.</span>c_<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	stack<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>stack<span class="token operator">&amp;&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">noexcept</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>is_nothrow_move_assignable<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>value<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_ <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>c_<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	stack<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>initializer_list<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> ilist<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_ <span class="token operator">=</span> ilist<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

	<span class="token comment">/*! 访问元素相关操作 */</span>
	reference       <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c_<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	const_reference <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c_<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token comment">/*! 容量相关操作 */</span>
	<span class="token keyword">bool</span>      <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c_<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	size_type <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token keyword">noexcept</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> c_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	<span class="token comment">/*! 修改容器相关操作 */</span>
	<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> Args<span class="token operator">&gt;</span>
	<span class="token keyword">void</span> <span class="token function">emplace</span><span class="token punctuation">(</span>Args<span class="token operator">&amp;&amp;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>args<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_<span class="token punctuation">.</span><span class="token function">emplace_back</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">forward</span><span class="token generic class-name"><span class="token operator">&lt;</span>Args<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span>value_type<span class="token operator">&amp;&amp;</span> value<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		c_<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	。。。
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>queue.h中有个优先队列，其实现就是主要依靠底层容器和heap.algo.h中的四个算法。</p> <h2 id="关联式容器"><a href="#关联式容器" class="header-anchor">#</a> 关联式容器</h2> <h3 id="rb-tree"><a href="#rb-tree" class="header-anchor">#</a> RB-tree</h3> <h4 id="为什么用红黑树"><a href="#为什么用红黑树" class="header-anchor">#</a> 为什么用红黑树</h4> <p>简单看一下其他的树：</p> <h5 id="_1、二叉查找树"><a href="#_1、二叉查找树" class="header-anchor">#</a> 1、二叉查找树</h5> <p>左结点小于根节点，右结点大于根节点的一种排序树。<br>
问题：有一种极端的情况，会变成一种类似线性链表似的结构。时间复杂度就为<code>O(N)</code>，所以出现了二叉平衡树。<br> <img src="/assets/c19e37b184d9442ca168dd39cb877b5f.png" alt="在这里插入图片描述"></p> <h5 id="_2、平衡二叉树"><a href="#_2、平衡二叉树" class="header-anchor">#</a> 2、平衡二叉树</h5> <p>解决二叉查找树的问题，保证了不会成为线性的链表。<br>
左结点小于根节点，右结点大于根节点，并且还规定了左子树和右子树的高度差不得超过1。<br>
问题：</p> <ol><li>由于要维持自身的平衡，所以进行插入和删除结点操作的时候，需要对结点进行频繁的旋转。</li> <li>每一个节点只能存放一个元素，每个节点只有两个子节点，所以查找时，需要多次磁盘IO（如果数据存放在磁盘中的，每次查询是将磁盘中的一页数据加入内存，树的每一层节点存放在一页中，不同层数据存放在不同页。）</li></ol> <h5 id="_3、b树"><a href="#_3、b树" class="header-anchor">#</a> 3、B树</h5> <p>解决平衡二叉树的第二个问题，是一种多路平衡树，MongoDB的索引就是用B树实现的。<br>
一个m阶的B树规定了：</p> <ol><li>根结点至少有两个子女。</li> <li>每个中间节点都包含k-1个元素和k个孩子，其中 m/2 &lt;= k &lt;= m 。</li> <li>每一个叶子节点都包含k-1个元素，其中 m/2 &lt;= k &lt;= m。</li> <li>所有的叶子结点都位于同一层。</li> <li>每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的值域分划。</li></ol> <p><img src="/assets/0cc44422cd7b48bd94323c4cab5d421b.png" alt="在这里插入图片描述"><br>
问题：</p> <ol><li>查找不稳定，最好的情况就是在根节点查到了，最坏的情况就是在叶子结点查到。</li> <li>在遍历方面比较麻烦，由于需要进行中序遍历，所以也会进行一定数量的磁盘IO。</li></ol> <h5 id="_4、b-树"><a href="#_4、b-树" class="header-anchor">#</a> 4、B+树</h5> <p>解决B树第二个问题，每个非叶子结点存放的元素只用于索引作用，所有数据保存在叶子结点。<br>
一个m阶的B+树规定了：</p> <ol><li>有k个子树的中间节点包含有k个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引，所有数据都保存在叶子节点。</li> <li>所有的叶子结点中包含了全部元素的信息，及指向含这些元素记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。</li> <li>所有的中间节点元素都同时存在于子节点，在子节点元素中是最大（或最小）元素。</li></ol> <p><img src="/assets/674901e01fcc440fb250e3ccb69d4b1f.png" alt="在这里插入图片描述"><br>
非叶子结点中存放的元素不存放数据，所以每一层可以容纳更多元素，也就是磁盘中的每一页可以存放更多元素。这样在查找时，磁盘IO的次数也会减少。<br>
查找稳定，因为所有的数据都在叶子结点。每个叶子结点也通过指针指向构成了一种链表结构，所以遍历数据也会简单很多。</p> <h5 id="_5、rb-tree"><a href="#_5、rb-tree" class="header-anchor">#</a> 5、RB-Tree</h5> <p>解决了平衡二叉树第一个问题，不严格控制左、右子树高度或节点数之差小于等于1。<br>
红黑树规定了：</p> <ol><li>节点是红色或黑色。</li> <li>根节点是黑色。</li> <li>每个叶子节点都是黑色的空节点（NIL节点）。</li> <li>每个红色节点的两个子节点都是黑色。也就是说从每个叶子到根的所有路径上不能有两个连续的红色节点)。</li> <li>从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点。</li></ol> <p><img src="/assets/e13578b978604b10a730af92d48e8b7c.png" alt="在这里插入图片描述"><br>
**红黑树在查找方面和AVL树操作几乎相同。**牺牲了严格的高度平衡的优越条件为代价，它只要求部分地达到平衡要求，结合变色，降低了对旋转的要求，从而提高了性能。任何不平衡都会在三次旋转之内解决。<br>
确保树的最长路径不大于两倍的最短路径的长度，所以可以看出它的查找效果是有最低保证的。在最坏的情况下也可以保证O(logN)。</p> <h5 id="比较"><a href="#比较" class="header-anchor">#</a> 比较</h5> <p>B/B+树用在磁盘文件组织、数据索引和数据库索引中。B+树比B树更适合实际应用中操作系统的文件索引和数据库索引。<br>
红黑树，读取略逊于AVL，维护强于AVL，每次插入和删除的平均旋转次数应该是远小于平衡树。如果插入的数据很乱AVL就不太行了，所以这里使用红黑树。</p> <h4 id="实现"><a href="#实现" class="header-anchor">#</a> 实现</h4> <p><code>header_</code>一个不存放值的哨兵节点</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">rb_tree</span>
<span class="token punctuation">{</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> rb_tree_traits<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                        tree_traits<span class="token punctuation">;</span>	<span class="token comment">/*! 树基本信息萃取机 */</span>
	<span class="token keyword">typedef</span> rb_tree_value_traits<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                  value_traits<span class="token punctuation">;</span>	<span class="token comment">/*! 树存储值萃取机 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>base_type          base_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>base_ptr           base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>node_type          node_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>node_ptr           node_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>key_type           key_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>mapped_type        mapped_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">tree_traits</span><span class="token double-colon punctuation">::</span>value_type         value_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> Compare                                  key_compare<span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      allocator_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      data_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>base_type<span class="token operator">&gt;</span>              base_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 基本节点分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>node_type<span class="token operator">&gt;</span>              node_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 数据节点分配器 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>pointer         pointer<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_pointer   const_pointer<span class="token punctuation">;</span>		<span class="token comment">/*! const数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>reference       reference<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_reference const_reference<span class="token punctuation">;</span>	<span class="token comment">/*! const数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>size_type       size_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型大小 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>difference_type difference_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据类型指针距离 */</span>

	<span class="token keyword">typedef</span> rb_tree_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                      iterator<span class="token punctuation">;</span>					<span class="token comment">/*! 迭代器（这里就是结构体） */</span>
	<span class="token keyword">typedef</span> rb_tree_const_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                const_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! const迭代器（这里就是const结构体） */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>iterator<span class="token operator">&gt;</span>        reverse_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! 反向迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>reverse_iterator<span class="token operator">&lt;</span>const_iterator<span class="token operator">&gt;</span>  const_reverse_iterator<span class="token punctuation">;</span>	<span class="token comment">/*! 反向const迭代器 */</span>

	allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">node_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	key_compare    <span class="token function">key_comp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> key_comp_<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">/*! 用以下三个数据表现 rb tree */</span>
	base_ptr    header_<span class="token punctuation">;</span>      <span class="token comment">/*! 特殊节点，与根节点互为对方的父节点 */</span>
	size_type   node_count_<span class="token punctuation">;</span>  <span class="token comment">/*! 节点数 */</span>
	key_compare key_comp_<span class="token punctuation">;</span>    <span class="token comment">/*! 节点键值比较的准则 */</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>节点需要设计和链表类似，需要连接左右节点和父节点。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/*! rb tree 基本节点 用来连接的 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">rb_tree_node_base</span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> rb_tree_color_type    color_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> rb_tree_node_base<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> rb_tree_node<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span>      node_ptr<span class="token punctuation">;</span>

	base_ptr   parent<span class="token punctuation">;</span>  <span class="token comment">/*! 父节点 */</span>
	base_ptr   left<span class="token punctuation">;</span>    <span class="token comment">/*! 左子节点 */</span>
	base_ptr   right<span class="token punctuation">;</span>   <span class="token comment">/*! 右子节点 */</span>
	color_type color<span class="token punctuation">;</span>   <span class="token comment">/*! 节点颜色 */</span>

	base_ptr <span class="token function">get_base_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	node_ptr <span class="token function">get_node_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>node_ptr<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	node_ptr<span class="token operator">&amp;</span> <span class="token function">get_node_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">reinterpret_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>node_ptr<span class="token operator">&amp;</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*! rb tree 数据节点 用来保存数据的 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">rb_tree_node</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">rb_tree_node_base</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> rb_tree_node_base<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> base_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> rb_tree_node<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span>      node_ptr<span class="token punctuation">;</span>

	T value<span class="token punctuation">;</span>  <span class="token comment">/*! 节点值 */</span>

	base_ptr <span class="token function">get_base_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>base_ptr<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	node_ptr <span class="token function">get_node_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>下面主要看一下树的插入和删除是如何保持平衡的，在这之前先看一下左旋（右旋类似），<code>a</code>和<code>c</code>的相对位置是没有变的，还在两边，中间<code>x&lt;b&lt;y</code>，父节点从<code>x</code>变成了<code>y</code>，所以<code>b</code>挂载的节点也变了一下，注意一下节点为根节点的情况。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/*---------------------------------------*\
|       p                         p       |
|      / \                       / \      |
|     x   d    rotate left      y   d     |
|    / \       ===========&gt;    / \        |
|   a   y                     x   c       |
|      / \                   / \          |
|     b   c                 a   b         |
\*---------------------------------------*/</span>
<span class="token comment">/*! 左旋，参数一为左旋点，参数二为根节点 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">NodePtr</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">rb_tree_rotate_left</span><span class="token punctuation">(</span>NodePtr x<span class="token punctuation">,</span> NodePtr<span class="token operator">&amp;</span> root<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
<span class="token punctuation">{</span>
	<span class="token keyword">auto</span> y <span class="token operator">=</span> x<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>  <span class="token comment">// y 为 x 的右子节点</span>
	x<span class="token operator">-&gt;</span>right <span class="token operator">=</span> y<span class="token operator">-&gt;</span>left<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>y<span class="token operator">-&gt;</span>left <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		y<span class="token operator">-&gt;</span>left<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> x<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	y<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> root<span class="token punctuation">)</span> <span class="token comment">// 如果 x 为根节点，让 y 顶替 x 成为根节点</span>
	<span class="token punctuation">{</span>
		root <span class="token operator">=</span> y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_lchild</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果 x 是左子节点</span>
	<span class="token punctuation">{</span>
		x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>left <span class="token operator">=</span> y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token comment">// 如果 x 是右子节点</span>
	<span class="token punctuation">{</span>
		x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>right <span class="token operator">=</span> y<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 调整 x 与 y 的关系</span>
	y<span class="token operator">-&gt;</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>
	x<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>插入节点，根据规则5直接将新增的节点着色为red，还有可能会违背规则4，<br>
所以我们的核心思路就是<strong>将红色的节点移到根节点，然后将根节点设为黑色。</strong><br>
再看下面的case3、4、5就比较清楚了。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// 插入节点后使 rb tree 重新平衡，参数一为新增节点，参数二为根节点</span>
<span class="token comment">//</span>
<span class="token comment">// case 1: 新增节点位于根节点，令新增节点为黑</span>
<span class="token comment">// case 2: 新增节点的父节点为黑，没有破坏平衡，直接返回</span>
<span class="token comment">// case 3: 父节点和叔叔节点都为红</span>
<span class="token comment">//         令父节点和叔叔节点为黑，祖父节点为红，然后令祖父节点为当前节点，继续处理</span>
<span class="token comment">// case 4: 父节点为红，叔叔节点为 NIL 或黑色，父节点为左（右）孩子，当前节点为右（左）孩子，</span>
<span class="token comment">//         让父节点成为当前节点，再以当前节点为支点左（右）旋</span>
<span class="token comment">// case 5: 父节点为红，叔叔节点为 NIL 或黑色，父节点为左（右）孩子，当前节点为左（右）孩子，</span>
<span class="token comment">//         让父节点变为黑色，祖父节点变为红色，以祖父节点为支点右（左）旋</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">NodePtr</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">rb_tree_insert_rebalance</span><span class="token punctuation">(</span>NodePtr x<span class="token punctuation">,</span> NodePtr<span class="token operator">&amp;</span> root<span class="token punctuation">)</span> <span class="token keyword">noexcept</span>
<span class="token punctuation">{</span>
	<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 新增节点为红色</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> root <span class="token operator">&amp;&amp;</span> <span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_lchild</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果父节点是左子节点</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">auto</span> uncle <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">!=</span> <span class="token keyword">nullptr</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 3: 父节点和叔叔节点都为红</span>
			<span class="token punctuation">{</span>
				<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span><span class="token punctuation">;</span>
				x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
				<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">// 无叔叔节点或叔叔节点为黑</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">rb_tree_is_lchild</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 4: 当前节点 x 为右子节点</span>
				<span class="token punctuation">{</span>
					x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
					<span class="token function">rb_tree_rotate_left</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 都转换成 case 5： 当前节点为左子节点</span>
				<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">rb_tree_rotate_right</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>  <span class="token comment">// 如果父节点是右子节点，对称处理</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">auto</span> uncle <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>left<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">!=</span> <span class="token keyword">nullptr</span> <span class="token operator">&amp;&amp;</span> <span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 3: 父节点和叔叔节点都为红</span>
			<span class="token punctuation">{</span>
				<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span><span class="token punctuation">;</span>
				x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
				<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 此时祖父节点为红，可能会破坏红黑树的性质，令当前节点为祖父节点，继续处理</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">// 无叔叔节点或叔叔节点为黑</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_lchild</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 4: 当前节点 x 为左子节点</span>
				<span class="token punctuation">{</span>
					x <span class="token operator">=</span> x<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
					<span class="token function">rb_tree_rotate_right</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 都转换成 case 5： 当前节点为左子节点</span>
				<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">rb_tree_rotate_left</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>parent<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 根节点永远为黑</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br></div></div><p>删除节点后，有可能会违背规则2、4、5，<br>
删除操作删除的结点可以看作删除替代结点，而替代结点最后总是在树末。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">// 删除节点后使 rb tree 重新平衡，参数一为要删除的节点，参数二为根节点，参数三为最小节点，参数四为最大节点</span>
<span class="token comment">// 1.没有儿子，即为叶结点。直接把父结点的对应儿子指针设为NULL，删除儿子结点就OK了。</span>
<span class="token comment">// 2.只有一个儿子。那么把父结点的相应儿子指针指向儿子的独生子，删除儿子结点也OK了。</span>
<span class="token comment">// 3.有两个儿子。这是最麻烦的情况，因为你删除节点之后，还要保证满足搜索二叉树的结构。</span>
<span class="token comment">//   其实也比较容易，我们可以选择左儿子中的最大元素或者右儿子中的最小元素放到待删除节点的位置，就可以保证结构的不变。</span>
<span class="token comment">//   当然，你要记得调整子树，毕竟又出现了节点删除。</span>
<span class="token comment">//   习惯上大家选择左儿子中的最大元素，其实选择右儿子的最小元素也一样，没有任何差别，只是人们习惯从左向右。</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">NodePtr</span><span class="token operator">&gt;</span>
NodePtr <span class="token function">rb_tree_erase_rebalance</span><span class="token punctuation">(</span>NodePtr z<span class="token punctuation">,</span> NodePtr<span class="token operator">&amp;</span> root<span class="token punctuation">,</span> NodePtr<span class="token operator">&amp;</span> leftmost<span class="token punctuation">,</span> NodePtr<span class="token operator">&amp;</span> rightmost<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// y 是可能的替换节点，指向最终要删除的节点</span>
	<span class="token keyword">auto</span> y <span class="token operator">=</span> <span class="token punctuation">(</span>z<span class="token operator">-&gt;</span>left <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> z<span class="token operator">-&gt;</span>right <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token operator">?</span> z <span class="token operator">:</span> <span class="token function">rb_tree_next</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// x 是 y 的一个独子节点或 NIL 节点</span>
	<span class="token keyword">auto</span> x <span class="token operator">=</span> y<span class="token operator">-&gt;</span>left <span class="token operator">!=</span> <span class="token keyword">nullptr</span> <span class="token operator">?</span> y<span class="token operator">-&gt;</span>left <span class="token operator">:</span> y<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
	<span class="token comment">// xp 为 x 的父节点</span>
	NodePtr xp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	<span class="token comment">// y != z 说明 z 有两个非空子节点，此时 y 指向 z 右子树的最左节点，x 指向 y 的右子节点。</span>
	<span class="token comment">// 用 y 顶替 z 的位置，用 x 顶替 y 的位置，最后用 y 指向 z</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> z<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		z<span class="token operator">-&gt;</span>left<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> y<span class="token punctuation">;</span>
		y<span class="token operator">-&gt;</span>left <span class="token operator">=</span> z<span class="token operator">-&gt;</span>left<span class="token punctuation">;</span>

		<span class="token comment">// 如果 y 不是 z 的右子节点，那么 z 的右子节点一定有左孩子    x 替换 y 的位置</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> z<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			xp <span class="token operator">=</span> y<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				x<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> y<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			y<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>
			y<span class="token operator">-&gt;</span>right <span class="token operator">=</span> z<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
			z<span class="token operator">-&gt;</span>right<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			xp <span class="token operator">=</span> y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 连接 y 与 z 的父节点 </span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> z<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			root <span class="token operator">=</span> y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_lchild</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			z<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>left <span class="token operator">=</span> y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			z<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>right <span class="token operator">=</span> y<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		y<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> z<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
		mystl<span class="token double-colon punctuation">::</span><span class="token function">swap</span><span class="token punctuation">(</span>y<span class="token operator">-&gt;</span>color<span class="token punctuation">,</span> z<span class="token operator">-&gt;</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
		y <span class="token operator">=</span> z<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token comment">// y == z 说明 z 至多只有一个孩子</span>
	<span class="token punctuation">{</span>
		xp <span class="token operator">=</span> y<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			x<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> y<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 连接 x 与 z 的父节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> z<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			root <span class="token operator">=</span> x<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_lchild</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			z<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			z<span class="token operator">-&gt;</span>parent<span class="token operator">-&gt;</span>right <span class="token operator">=</span> x<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 此时 z 有可能是最左节点或最右节点，更新数据</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>leftmost <span class="token operator">==</span> z<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			leftmost <span class="token operator">=</span> x <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">?</span> xp <span class="token operator">:</span> <span class="token function">rb_tree_min</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>rightmost <span class="token operator">==</span> z<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			rightmost <span class="token operator">=</span> x <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">?</span> xp <span class="token operator">:</span> <span class="token function">rb_tree_max</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 此时，y 指向要删除的节点，x 为替代节点，从 x 节点开始调整。</span>
	<span class="token comment">// 如果删除的节点为红色，树的性质没有被破坏，否则按照以下情况调整（x 为左子节点为例）：</span>
	<span class="token comment">// case 1: 兄弟节点为红色，</span>
	<span class="token comment">//         令父节点为红，兄弟节点为黑，进行左（右）旋，继续处理</span>
	<span class="token comment">// case 2: 兄弟节点为黑色，且两个子节点都为黑色或 NIL，</span>
	<span class="token comment">//         令兄弟节点为红，父节点成为当前节点，继续处理</span>
	<span class="token comment">// case 3: 兄弟节点为黑色，左子节点为红色或 NIL，右子节点为黑色或 NIL，</span>
	<span class="token comment">//         令兄弟节点为红，兄弟节点的左子节点为黑，以兄弟节点为支点右（左）旋，继续处理</span>
	<span class="token comment">// case 4: 兄弟节点为黑色，右子节点为红色，</span>
	<span class="token comment">//         令兄弟节点为父节点的颜色，父节点为黑色，兄弟节点的右子节点为黑色，以父节点为支点左（右）旋，树的性质调整完成，算法结束</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// x 为黑色时，调整，否则直接将 x 变为黑色即可</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> root <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> xp<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span> <span class="token comment">// 如果 x 为左子节点</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">auto</span> brother <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 1</span>
				<span class="token punctuation">{</span>
					<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>xp<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">rb_tree_rotate_left</span><span class="token punctuation">(</span>xp<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
					brother <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// case 1 转为为了 case 2、3、4 中的一种</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
					<span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 2</span>
				<span class="token punctuation">{</span>
					<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
					x <span class="token operator">=</span> xp<span class="token punctuation">;</span>
					xp <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 3</span>
					<span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
						<span class="token punctuation">{</span>
							<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">rb_tree_rotate_right</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
						brother <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 转为 case 4</span>
					brother<span class="token operator">-&gt;</span>color <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>color<span class="token punctuation">;</span>
					<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>xp<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token function">rb_tree_rotate_left</span><span class="token punctuation">(</span>xp<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>  <span class="token comment">// x 为右子节点，对称处理</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">auto</span> brother <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>left<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 1</span>
				<span class="token punctuation">{</span>
					<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>xp<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">rb_tree_rotate_right</span><span class="token punctuation">(</span>xp<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
					brother <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>left<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
					<span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 2</span>
				<span class="token punctuation">{</span>
					<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
					x <span class="token operator">=</span> xp<span class="token punctuation">;</span>
					xp <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left <span class="token operator">==</span> <span class="token keyword">nullptr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">rb_tree_is_red</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 3</span>
					<span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
						<span class="token punctuation">{</span>
							<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token function">rb_tree_set_red</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">rb_tree_rotate_left</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
						brother <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>left<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 转为 case 4</span>
					brother<span class="token operator">-&gt;</span>color <span class="token operator">=</span> xp<span class="token operator">-&gt;</span>color<span class="token punctuation">;</span>
					<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>xp<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>brother<span class="token operator">-&gt;</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token function">rb_tree_rotate_right</span><span class="token punctuation">(</span>xp<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">rb_tree_set_black</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br></div></div><p>插入一个节点</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">insert_multi</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">THROW_LENGTH_ERROR_IF</span><span class="token punctuation">(</span>node_count_ <span class="token operator">&gt;</span> <span class="token function">max_size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;rb_tree&lt;T, Comp&gt;'s size too big&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> res <span class="token operator">=</span> <span class="token function">get_insert_multi_pos</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">insert_value_at</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>first<span class="token punctuation">,</span> value<span class="token punctuation">,</span> res<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 获取可重复插入位置 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
mystl<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>base_ptr<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">get_insert_multi_pos</span><span class="token punctuation">(</span><span class="token keyword">const</span> key_type<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">auto</span> x <span class="token operator">=</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> y <span class="token operator">=</span> header_<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> add_to_left <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">// 是否在左边</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>	<span class="token comment">// 逐个寻找比较</span>
	<span class="token punctuation">{</span>
		y <span class="token operator">=</span> x<span class="token punctuation">;</span>
		add_to_left <span class="token operator">=</span> <span class="token function">key_comp_</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>x<span class="token operator">-&gt;</span><span class="token function">get_node_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		x <span class="token operator">=</span> add_to_left <span class="token operator">?</span> x<span class="token operator">-&gt;</span>left <span class="token operator">:</span> x<span class="token operator">-&gt;</span>right<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">make_pair</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> add_to_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 在 x 节点处插入新的节点 x 为插入点的父节点， value 为要插入的值，add_to_left 表示是否在左边插入 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">insert_value_at</span><span class="token punctuation">(</span>base_ptr x<span class="token punctuation">,</span> <span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">,</span> <span class="token keyword">bool</span> add_to_left<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	node_ptr node <span class="token operator">=</span> <span class="token function">create_node</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	node<span class="token operator">-&gt;</span>parent <span class="token operator">=</span> x<span class="token punctuation">;</span>
	<span class="token keyword">auto</span> base_node <span class="token operator">=</span> node<span class="token operator">-&gt;</span><span class="token function">get_base_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> header_<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
		<span class="token function">leftmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
		<span class="token function">rightmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>add_to_left<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		x<span class="token operator">-&gt;</span>left <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">leftmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> x<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">leftmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		x<span class="token operator">-&gt;</span>right <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rightmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> x<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">rightmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> base_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">rb_tree_insert_rebalance</span><span class="token punctuation">(</span>base_node<span class="token punctuation">,</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">++</span>node_count_<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p>删除节点</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token comment">/*! 删除键值等于 key 的元素，返回删除的个数 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>size_type <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">erase_multi</span><span class="token punctuation">(</span><span class="token keyword">const</span> key_type<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">auto</span> p <span class="token operator">=</span> <span class="token function">equal_range_multi</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	size_type n <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">distance</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>first<span class="token punctuation">,</span> p<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">erase</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>first<span class="token punctuation">,</span> p<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 得到包围key的范围 */</span>
mystl<span class="token double-colon punctuation">::</span>pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> iterator<span class="token operator">&gt;</span> <span class="token function">equal_range_multi</span><span class="token punctuation">(</span><span class="token keyword">const</span> key_type<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">return</span> mystl<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">pair</span><span class="token generic class-name"><span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> iterator<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">upper_bound</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 删除[first, last)区间内的元素 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">erase</span><span class="token punctuation">(</span>iterator first<span class="token punctuation">,</span> iterator last<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token operator">==</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> last <span class="token operator">==</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>first <span class="token operator">!=</span> last<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">erase</span><span class="token punctuation">(</span>first<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*! 删除 hint 位置的节点 */</span>
<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Compare</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator <span class="token class-name">rb_tree</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Compare<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">erase</span><span class="token punctuation">(</span>iterator hint<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">auto</span> node <span class="token operator">=</span> hint<span class="token punctuation">.</span>node<span class="token operator">-&gt;</span><span class="token function">get_node_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	iterator <span class="token function">next</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">++</span>next<span class="token punctuation">;</span>

	<span class="token function">rb_tree_erase_rebalance</span><span class="token punctuation">(</span>hint<span class="token punctuation">.</span>node<span class="token punctuation">,</span> <span class="token function">root</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">leftmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rightmost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">destroy_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">--</span>node_count_<span class="token punctuation">;</span>
	<span class="token keyword">return</span> next<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="set、multiset、map和multimap"><a href="#set、multiset、map和multimap" class="header-anchor">#</a> set、multiset、map和multimap</h3> <p>这四个都是配接器，底层容器使用的RB-tree，所以都是有序的。只是做了接口的转换，可以自己看源码。</p> <h3 id="hashtable"><a href="#hashtable" class="header-anchor">#</a> hashtable</h3> <p>哈希表我们应该都很熟悉了，在插入删除等操作都可以做到O(1)的时间复杂度。<br>
散列函数能使对一个数据序列的访问过程更加迅速有效，通过散列函数，数据元素将被更快地定位。</p> <h4 id="常用hash函数"><a href="#常用hash函数" class="header-anchor">#</a> 常用Hash函数</h4> <ol><li><strong>直接寻址法</strong>：取关键字或关键字的某个线性函数值为散列地址。即H(key)=key或H(key) = a·key + b，其中a和b为常数（这种散列函数叫做自身函数）。</li> <li><strong>数字分析法</strong>：分析一组数据，比如一组员工的出生年月日，这时我们发现出生年月日的前几位数字大体相同，这样的话，出现冲突的几率就会很大，但是我们发现年月日的后几位表示月份和具体日期的数字差别很大，如果用后面的数字来构成散列地址，则冲突的几率会明显降低。因此数字分析法就是找出数字的规律，尽可能利用这些数据来构造冲突几率较低的散列地址。</li> <li><strong>平方取中法</strong>：取关键字平方后的中间几位作为散列地址。</li> <li><strong>折叠法</strong>：将关键字分割成位数相同的几部分，最后一部分位数可以不同，然后取这几部分的叠加和（去除进位）作为散列地址。</li> <li><strong>随机数法</strong>：选择一随机函数，取关键字作为随机函数的种子生成随机值作为散列地址，通常用于关键字长度不同的场合。</li> <li><strong>除留余数法</strong>：取关键字被某个不大于散列表表长m的数p除后所得的余数为散列地址。即 H(key) = key MOD p,p&lt;=m。不仅可以对关键字直接取模，也可在折叠、平方取中等运算之后取模。对p的选择很重要，一般取素数或m，若p选的不好，容易产生碰撞。</li></ol> <h4 id="冲突处理"><a href="#冲突处理" class="header-anchor">#</a> 冲突处理</h4> <ol><li>开放寻址法；Hi=(H(key) + di) MOD m,i=1,2,…，k(k&lt;=m-1)，其中H(key)为散列函数，m为散列表长，di为增量序列，可有下列三种取法：
<ul><li>di=1,2,3,…，m-1，称线性探测再散列；</li> <li>di=12,-12,22,-22,32,…，±k2,(k&lt;=m/2)称二次探测再散列；</li> <li>di=伪随机数序列，称伪随机探测再散列。</li></ul></li> <li>再散列法：Hi=RHi(key),i=1,2,…，k RHi均是不同的散列函数，即在同义词产生地址冲突时计算另一个散列函数地址，直到冲突不再发生，这种方法不易产生“聚集”，但增加了计算时间。</li> <li>链地址法(拉链法)</li> <li>建立一个公共溢出区</li></ol> <h4 id="设计"><a href="#设计" class="header-anchor">#</a> 设计</h4> <p>采用链地址法解决冲突，所以整个哈希表的数据结构就像下图所示：<br> <img src="/assets/4efaf7eaac93433ea8eafa43e5fed7c2.png" alt="在这里插入图片描述"><br>
其中节点定义（单链表）</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">hashtable_node</span>
<span class="token punctuation">{</span>
	hashtable_node<span class="token operator">*</span> next<span class="token punctuation">;</span>   <span class="token comment">/*! 指向下一个节点 */</span>
	T               value<span class="token punctuation">;</span>  <span class="token comment">/*! 储存实值 */</span>

	<span class="token function">hashtable_node</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
	<span class="token function">hashtable_node</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> n<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">value</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token function">hashtable_node</span><span class="token punctuation">(</span><span class="token keyword">const</span> hashtable_node<span class="token operator">&amp;</span> node<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">next</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">value</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token function">hashtable_node</span><span class="token punctuation">(</span>hashtable_node<span class="token operator">&amp;&amp;</span> node<span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">next</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">value</span><span class="token punctuation">(</span>mystl<span class="token double-colon punctuation">::</span><span class="token function">move</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		node<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>桶就用一个<code>vector</code>表示，哈希函数由参数传递（默认使用算法中的哈希函数）。<br> <code>mlf_</code>是一个比例（装入表中的元素 / 表的实际大小），越大说明冲突的可能性就越大。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">hashtable</span>
<span class="token punctuation">{</span>

	<span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">mystl</span><span class="token operator">:</span><span class="token base-clause"><span class="token operator">:</span><span class="token class-name">ht_iterator</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span></span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">mystl</span><span class="token operator">:</span><span class="token base-clause"><span class="token operator">:</span><span class="token class-name">ht_const_iterator</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> ht_value_traits<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                          value_traits<span class="token punctuation">;</span>	<span class="token comment">/*! 数据类型 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">value_traits</span><span class="token double-colon punctuation">::</span>key_type             key_type<span class="token punctuation">;</span>		<span class="token comment">/*! 键 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">value_traits</span><span class="token double-colon punctuation">::</span>mapped_type          mapped_type<span class="token punctuation">;</span>	<span class="token comment">/*! 映射的类型 如果T是一个pair的话就是第二个元素 否则就是T */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">value_traits</span><span class="token double-colon punctuation">::</span>value_type           value_type<span class="token punctuation">;</span>		<span class="token comment">/*! 值 */</span>
	<span class="token keyword">typedef</span> Hash                                        hasher<span class="token punctuation">;</span>			<span class="token comment">/*! 哈希函数类型 */</span>
	<span class="token keyword">typedef</span> KeyEqual                                    key_equal<span class="token punctuation">;</span>		<span class="token comment">/*! 键值相等的比较函数类型 */</span>

	<span class="token keyword">typedef</span> hashtable_node<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                           node_type<span class="token punctuation">;</span>		<span class="token comment">/*! 节点类型 */</span>
	<span class="token keyword">typedef</span> node_type<span class="token operator">*</span>                                  node_ptr<span class="token punctuation">;</span>		<span class="token comment">/*! 节点指针类型 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>node_ptr<span class="token operator">&gt;</span>                     bucket_type<span class="token punctuation">;</span>	<span class="token comment">/*! 桶数组类型 */</span>

	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                         allocator_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                         data_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 数据分配器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>allocator<span class="token operator">&lt;</span>node_type<span class="token operator">&gt;</span>                 node_allocator<span class="token punctuation">;</span>	<span class="token comment">/*! 节点分配器 */</span>

	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>pointer            pointer<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_pointer      const_pointer<span class="token punctuation">;</span>		<span class="token comment">/*! const数据类型指针 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>reference          reference<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>const_reference    const_reference<span class="token punctuation">;</span>	<span class="token comment">/*! const数据类型引用 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>size_type          size_type<span class="token punctuation">;</span>			<span class="token comment">/*! 数据类型大小 */</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">allocator_type</span><span class="token double-colon punctuation">::</span>difference_type    difference_type<span class="token punctuation">;</span>	<span class="token comment">/*! 数据类型指针距离 */</span>

	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>ht_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span>       iterator<span class="token punctuation">;</span>				<span class="token comment">/*! 迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>ht_const_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! const迭代器 */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>ht_local_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                 local_iterator<span class="token punctuation">;</span>			<span class="token comment">/*! 迭代器（不指向其他桶） */</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>ht_const_local_iterator<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>           const_local_iterator<span class="token punctuation">;</span>	<span class="token comment">/*! const迭代器（不指向其他桶） */</span>

	allocator_type <span class="token function">get_allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">allocator_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">/*! 用以下六个参数来表现 hashtable */</span>
	bucket_type buckets_<span class="token punctuation">;</span>		<span class="token comment">/*! 桶数组 使用vector */</span>
	size_type   bucket_size_<span class="token punctuation">;</span>	<span class="token comment">/*! 桶数量 */</span>
	size_type   size_<span class="token punctuation">;</span>			<span class="token comment">/*! 元素数量 */</span>
	<span class="token keyword">float</span>       mlf_<span class="token punctuation">;</span>			<span class="token comment">/*! 最大桶装载比例 */</span>
	hasher      hash_<span class="token punctuation">;</span>			<span class="token comment">/*! 哈希仿函数 */</span>
	key_equal   equal_<span class="token punctuation">;</span>			<span class="token comment">/*! 键值相等的比较仿函数 */</span>
	。。。
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>迭代器继承的是<code>forward_iterator_tag</code>，所以只能往前遍历，不能回退。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">ht_iterator_base</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> mystl<span class="token double-colon punctuation">::</span><span class="token class-name">iterator</span><span class="token operator">&lt;</span>mystl<span class="token double-colon punctuation">::</span><span class="token class-name">forward_iterator_tag</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>hashtable<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span>         hashtable<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> ht_iterator_base<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span>         base<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>ht_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span>       iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> mystl<span class="token double-colon punctuation">::</span>ht_const_iterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> hashtable_node<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span>                          node_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> hashtable<span class="token operator">*</span>                                  contain_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">const</span> node_ptr                              const_node_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">const</span> contain_ptr                           const_contain_ptr<span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> size_t                                      size_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> ptrdiff_t                                   difference_type<span class="token punctuation">;</span>

	node_ptr    node<span class="token punctuation">;</span>  <span class="token comment">/*! 迭代器当前所指节点 */</span>
	contain_ptr ht<span class="token punctuation">;</span>    <span class="token comment">/*! 保持与容器的连结 */</span>

	<span class="token function">ht_iterator_base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node <span class="token operator">==</span> rhs<span class="token punctuation">.</span>node<span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> base<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node <span class="token operator">!=</span> rhs<span class="token punctuation">.</span>node<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">ht_iterator</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">ht_iterator_base</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span></span>
<span class="token punctuation">{</span>
	<span class="token keyword">typedef</span> ht_iterator_base<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span> base<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">base</span><span class="token double-colon punctuation">::</span>hashtable            hashtable<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">base</span><span class="token double-colon punctuation">::</span>iterator             iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">base</span><span class="token double-colon punctuation">::</span>const_iterator       const_iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">base</span><span class="token double-colon punctuation">::</span>node_ptr             node_ptr<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">base</span><span class="token double-colon punctuation">::</span>contain_ptr          contain_ptr<span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> ht_value_traits<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>                  value_traits<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> T                                   value_type<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> value_type<span class="token operator">*</span>                         pointer<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> value_type<span class="token operator">&amp;</span>                         reference<span class="token punctuation">;</span>

	<span class="token keyword">using</span> base<span class="token double-colon punctuation">::</span>node<span class="token punctuation">;</span>
	<span class="token keyword">using</span> base<span class="token double-colon punctuation">::</span>ht<span class="token punctuation">;</span>

	<span class="token function">ht_iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
	<span class="token function">ht_iterator</span><span class="token punctuation">(</span>node_ptr n<span class="token punctuation">,</span> contain_ptr t<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		node <span class="token operator">=</span> n<span class="token punctuation">;</span>
		ht <span class="token operator">=</span> t<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">ht_iterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> iterator<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		node <span class="token operator">=</span> rhs<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
		ht <span class="token operator">=</span> rhs<span class="token punctuation">.</span>ht<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">ht_iterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> const_iterator<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		node <span class="token operator">=</span> rhs<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
		ht <span class="token operator">=</span> rhs<span class="token punctuation">.</span>ht<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	iterator<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> iterator<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			node <span class="token operator">=</span> rhs<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
			ht <span class="token operator">=</span> rhs<span class="token punctuation">.</span>ht<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	iterator<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> const_iterator<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			node <span class="token operator">=</span> rhs<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
			ht <span class="token operator">=</span> rhs<span class="token punctuation">.</span>ht<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	reference <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> node<span class="token operator">-&gt;</span>value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
	pointer   <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

	iterator<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">MYSTL_DEBUG</span><span class="token punctuation">(</span>node <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> node_ptr old <span class="token operator">=</span> node<span class="token punctuation">;</span>
		node <span class="token operator">=</span> node<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>	<span class="token comment">// 如果下一个位置为空，跳到下一个 bucket 的起始处</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">auto</span> index <span class="token operator">=</span> ht<span class="token operator">-&gt;</span><span class="token function">hash</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>old<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>node <span class="token operator">&amp;&amp;</span> <span class="token operator">++</span>index <span class="token operator">&lt;</span> ht<span class="token operator">-&gt;</span>bucket_size_<span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				node <span class="token operator">=</span> ht<span class="token operator">-&gt;</span>buckets_<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	iterator <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		iterator tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token operator">++</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br></div></div><p>哈希表的的大小都是素数, 减少冲突。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">SYSTEM_64</span></span>

	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PRIME_NUM</span> <span class="token expression"><span class="token number">99</span></span></span>

	<span class="token comment">// 1. start with p = 101</span>
	<span class="token comment">// 2. p = next_prime(p * 1.7)</span>
	<span class="token comment">// 3. if p &lt; (2 &lt;&lt; 63), go to step 2, otherwise, go to step 4</span>
	<span class="token comment">// 4. end with p = prev_prime(2 &lt;&lt; 63 - 1)</span>
	<span class="token keyword">static</span> <span class="token keyword">constexpr</span> size_t ht_prime_list<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
	  <span class="token number">101ull</span><span class="token punctuation">,</span> <span class="token number">173ull</span><span class="token punctuation">,</span> <span class="token number">263ull</span><span class="token punctuation">,</span> <span class="token number">397ull</span><span class="token punctuation">,</span> <span class="token number">599ull</span><span class="token punctuation">,</span> <span class="token number">907ull</span><span class="token punctuation">,</span> <span class="token number">1361ull</span><span class="token punctuation">,</span> <span class="token number">2053ull</span><span class="token punctuation">,</span> <span class="token number">3083ull</span><span class="token punctuation">,</span>
	  <span class="token number">4637ull</span><span class="token punctuation">,</span> <span class="token number">6959ull</span><span class="token punctuation">,</span> <span class="token number">10453ull</span><span class="token punctuation">,</span> <span class="token number">15683ull</span><span class="token punctuation">,</span> <span class="token number">23531ull</span><span class="token punctuation">,</span> <span class="token number">35311ull</span><span class="token punctuation">,</span> <span class="token number">52967ull</span><span class="token punctuation">,</span> <span class="token number">79451ull</span><span class="token punctuation">,</span>
	  <span class="token number">119179ull</span><span class="token punctuation">,</span> <span class="token number">178781ull</span><span class="token punctuation">,</span> <span class="token number">268189ull</span><span class="token punctuation">,</span> <span class="token number">402299ull</span><span class="token punctuation">,</span> <span class="token number">603457ull</span><span class="token punctuation">,</span> <span class="token number">905189ull</span><span class="token punctuation">,</span> <span class="token number">1357787ull</span><span class="token punctuation">,</span>
	  <span class="token number">2036687ull</span><span class="token punctuation">,</span> <span class="token number">3055043ull</span><span class="token punctuation">,</span> <span class="token number">4582577ull</span><span class="token punctuation">,</span> <span class="token number">6873871ull</span><span class="token punctuation">,</span> <span class="token number">10310819ull</span><span class="token punctuation">,</span> <span class="token number">15466229ull</span><span class="token punctuation">,</span>
	  <span class="token number">23199347ull</span><span class="token punctuation">,</span> <span class="token number">34799021ull</span><span class="token punctuation">,</span> <span class="token number">52198537ull</span><span class="token punctuation">,</span> <span class="token number">78297827ull</span><span class="token punctuation">,</span> <span class="token number">117446801ull</span><span class="token punctuation">,</span> <span class="token number">176170229ull</span><span class="token punctuation">,</span>
	  <span class="token number">264255353ull</span><span class="token punctuation">,</span> <span class="token number">396383041ull</span><span class="token punctuation">,</span> <span class="token number">594574583ull</span><span class="token punctuation">,</span> <span class="token number">891861923ull</span><span class="token punctuation">,</span> <span class="token number">1337792887ull</span><span class="token punctuation">,</span>
	  <span class="token number">2006689337ull</span><span class="token punctuation">,</span> <span class="token number">3010034021ull</span><span class="token punctuation">,</span> <span class="token number">4515051137ull</span><span class="token punctuation">,</span> <span class="token number">6772576709ull</span><span class="token punctuation">,</span> <span class="token number">10158865069ull</span><span class="token punctuation">,</span>
	  <span class="token number">15238297621ull</span><span class="token punctuation">,</span> <span class="token number">22857446471ull</span><span class="token punctuation">,</span> <span class="token number">34286169707ull</span><span class="token punctuation">,</span> <span class="token number">51429254599ull</span><span class="token punctuation">,</span> <span class="token number">77143881917ull</span><span class="token punctuation">,</span>
	  <span class="token number">115715822899ull</span><span class="token punctuation">,</span> <span class="token number">173573734363ull</span><span class="token punctuation">,</span> <span class="token number">260360601547ull</span><span class="token punctuation">,</span> <span class="token number">390540902329ull</span><span class="token punctuation">,</span>
	  <span class="token number">585811353559ull</span><span class="token punctuation">,</span> <span class="token number">878717030339ull</span><span class="token punctuation">,</span> <span class="token number">1318075545511ull</span><span class="token punctuation">,</span> <span class="token number">1977113318311ull</span><span class="token punctuation">,</span>
	  <span class="token number">2965669977497ull</span><span class="token punctuation">,</span> <span class="token number">4448504966249ull</span><span class="token punctuation">,</span> <span class="token number">6672757449409ull</span><span class="token punctuation">,</span> <span class="token number">10009136174239ull</span><span class="token punctuation">,</span>
	  <span class="token number">15013704261371ull</span><span class="token punctuation">,</span> <span class="token number">22520556392057ull</span><span class="token punctuation">,</span> <span class="token number">33780834588157ull</span><span class="token punctuation">,</span> <span class="token number">50671251882247ull</span><span class="token punctuation">,</span>
	  <span class="token number">76006877823377ull</span><span class="token punctuation">,</span> <span class="token number">114010316735089ull</span><span class="token punctuation">,</span> <span class="token number">171015475102649ull</span><span class="token punctuation">,</span> <span class="token number">256523212653977ull</span><span class="token punctuation">,</span>
	  <span class="token number">384784818980971ull</span><span class="token punctuation">,</span> <span class="token number">577177228471507ull</span><span class="token punctuation">,</span> <span class="token number">865765842707309ull</span><span class="token punctuation">,</span> <span class="token number">1298648764060979ull</span><span class="token punctuation">,</span>
	  <span class="token number">1947973146091477ull</span><span class="token punctuation">,</span> <span class="token number">2921959719137273ull</span><span class="token punctuation">,</span> <span class="token number">4382939578705967ull</span><span class="token punctuation">,</span> <span class="token number">6574409368058969ull</span><span class="token punctuation">,</span>
	  <span class="token number">9861614052088471ull</span><span class="token punctuation">,</span> <span class="token number">14792421078132871ull</span><span class="token punctuation">,</span> <span class="token number">22188631617199337ull</span><span class="token punctuation">,</span> <span class="token number">33282947425799017ull</span><span class="token punctuation">,</span>
	  <span class="token number">49924421138698549ull</span><span class="token punctuation">,</span> <span class="token number">74886631708047827ull</span><span class="token punctuation">,</span> <span class="token number">112329947562071807ull</span><span class="token punctuation">,</span> <span class="token number">168494921343107851ull</span><span class="token punctuation">,</span>
	  <span class="token number">252742382014661767ull</span><span class="token punctuation">,</span> <span class="token number">379113573021992729ull</span><span class="token punctuation">,</span> <span class="token number">568670359532989111ull</span><span class="token punctuation">,</span> <span class="token number">853005539299483657ull</span><span class="token punctuation">,</span>
	  <span class="token number">1279508308949225477ull</span><span class="token punctuation">,</span> <span class="token number">1919262463423838231ull</span><span class="token punctuation">,</span> <span class="token number">2878893695135757317ull</span><span class="token punctuation">,</span> <span class="token number">4318340542703636011ull</span><span class="token punctuation">,</span>
	  <span class="token number">6477510814055453699ull</span><span class="token punctuation">,</span> <span class="token number">9716266221083181299ull</span><span class="token punctuation">,</span> <span class="token number">14574399331624771603ull</span><span class="token punctuation">,</span> <span class="token number">18446744073709551557ull</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>

	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PRIME_NUM</span> <span class="token expression"><span class="token number">44</span></span></span>

	<span class="token comment">// 1. start with p = 101</span>
	<span class="token comment">// 2. p = next_prime(p * 1.7)</span>
	<span class="token comment">// 3. if p &lt; (2 &lt;&lt; 31), go to step 2, otherwise, go to step 4</span>
	<span class="token comment">// 4. end with p = prev_prime(2 &lt;&lt; 31 - 1)</span>
	<span class="token keyword">static</span> <span class="token keyword">constexpr</span> size_t ht_prime_list<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span>
	<span class="token punctuation">{</span>
	  <span class="token number">101u</span><span class="token punctuation">,</span> <span class="token number">173u</span><span class="token punctuation">,</span> <span class="token number">263u</span><span class="token punctuation">,</span> <span class="token number">397u</span><span class="token punctuation">,</span> <span class="token number">599u</span><span class="token punctuation">,</span> <span class="token number">907u</span><span class="token punctuation">,</span> <span class="token number">1361u</span><span class="token punctuation">,</span> <span class="token number">2053u</span><span class="token punctuation">,</span> <span class="token number">3083u</span><span class="token punctuation">,</span> <span class="token number">4637u</span><span class="token punctuation">,</span> <span class="token number">6959u</span><span class="token punctuation">,</span>
	  <span class="token number">10453u</span><span class="token punctuation">,</span> <span class="token number">15683u</span><span class="token punctuation">,</span> <span class="token number">23531u</span><span class="token punctuation">,</span> <span class="token number">35311u</span><span class="token punctuation">,</span> <span class="token number">52967u</span><span class="token punctuation">,</span> <span class="token number">79451u</span><span class="token punctuation">,</span> <span class="token number">119179u</span><span class="token punctuation">,</span> <span class="token number">178781u</span><span class="token punctuation">,</span> <span class="token number">268189u</span><span class="token punctuation">,</span>
	  <span class="token number">402299u</span><span class="token punctuation">,</span> <span class="token number">603457u</span><span class="token punctuation">,</span> <span class="token number">905189u</span><span class="token punctuation">,</span> <span class="token number">1357787u</span><span class="token punctuation">,</span> <span class="token number">2036687u</span><span class="token punctuation">,</span> <span class="token number">3055043u</span><span class="token punctuation">,</span> <span class="token number">4582577u</span><span class="token punctuation">,</span> <span class="token number">6873871u</span><span class="token punctuation">,</span>
	  <span class="token number">10310819u</span><span class="token punctuation">,</span> <span class="token number">15466229u</span><span class="token punctuation">,</span> <span class="token number">23199347u</span><span class="token punctuation">,</span> <span class="token number">34799021u</span><span class="token punctuation">,</span> <span class="token number">52198537u</span><span class="token punctuation">,</span> <span class="token number">78297827u</span><span class="token punctuation">,</span> <span class="token number">117446801u</span><span class="token punctuation">,</span>
	  <span class="token number">176170229u</span><span class="token punctuation">,</span> <span class="token number">264255353u</span><span class="token punctuation">,</span> <span class="token number">396383041u</span><span class="token punctuation">,</span> <span class="token number">594574583u</span><span class="token punctuation">,</span> <span class="token number">891861923u</span><span class="token punctuation">,</span> <span class="token number">1337792887u</span><span class="token punctuation">,</span>
	  <span class="token number">2006689337u</span><span class="token punctuation">,</span> <span class="token number">3010034021u</span><span class="token punctuation">,</span> <span class="token number">4294967291u</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">/*! 找出最接近并大于等于 n 的那个质数 */</span>
<span class="token keyword">inline</span> size_t <span class="token function">ht_next_prime</span><span class="token punctuation">(</span>size_t n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> size_t<span class="token operator">*</span> first <span class="token operator">=</span> ht_prime_list<span class="token punctuation">;</span>
	<span class="token keyword">const</span> size_t<span class="token operator">*</span> last <span class="token operator">=</span> ht_prime_list <span class="token operator">+</span> PRIME_NUM<span class="token punctuation">;</span>
	<span class="token keyword">const</span> size_t<span class="token operator">*</span> pos <span class="token operator">=</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">lower_bound</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> last<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> pos <span class="token operator">==</span> last <span class="token operator">?</span> <span class="token operator">*</span><span class="token punctuation">(</span>last <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">*</span>pos<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p>我们还是来看一下扩容的操作，首先默认构造，调用<code>next_size</code>得到桶数组大小<code>101u</code>。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">explicit</span> <span class="token function">hashtable</span><span class="token punctuation">(</span>size_type bucket_count<span class="token punctuation">,</span> <span class="token keyword">const</span> Hash<span class="token operator">&amp;</span> hash <span class="token operator">=</span> <span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">const</span> KeyEqual<span class="token operator">&amp;</span> equal <span class="token operator">=</span> <span class="token function">KeyEqual</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">size_</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mlf_</span><span class="token punctuation">(</span><span class="token number">1.0f</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">hash_</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">equal_</span><span class="token punctuation">(</span>equal<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">init</span><span class="token punctuation">(</span>bucket_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> bucket_nums <span class="token operator">=</span> <span class="token function">next_size</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{</span>
		buckets_<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>bucket_nums<span class="token punctuation">)</span><span class="token punctuation">;</span>
		buckets_<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>bucket_nums<span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		bucket_size_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		size_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">throw</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	bucket_size_ <span class="token operator">=</span> buckets_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>先看这个插入元素，节点键值允许重复的，先要查看是否超过最大桶装载比例，</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code>iterator <span class="token function">insert_multi</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">rehash_if_need</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">insert_multi_noresize</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">rehash_if_need</span><span class="token punctuation">(</span>size_type n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token generic-function"><span class="token function">static_cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">float</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>size_ <span class="token operator">+</span> n<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>bucket_size_ <span class="token operator">*</span> <span class="token function">max_load_factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">rehash</span><span class="token punctuation">(</span>size_ <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如果超过了就需要扩容，先申请一个新的桶数组，重新对元素进行一遍哈希，插入到新的桶，最后<code>swap</code>一下。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">rehash</span><span class="token punctuation">(</span>size_type count<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">auto</span> n <span class="token operator">=</span> <span class="token function">ht_next_prime</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> bucket_size_<span class="token punctuation">)</span>	<span class="token comment">// 扩大</span>
	<span class="token punctuation">{</span>
		<span class="token function">replace_bucket</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token comment">// 缩减</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>size_ <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>n <span class="token operator">&lt;</span> <span class="token function">max_load_factor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.25f</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>n <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>bucket_size_ <span class="token operator">*</span> <span class="token number">0.75</span><span class="token punctuation">)</span>  <span class="token comment">// 值得 rehash</span>
		<span class="token punctuation">{</span>
			<span class="token function">replace_bucket</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">replace_bucket</span><span class="token punctuation">(</span>size_type bucket_count<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	bucket_type <span class="token function">bucket</span><span class="token punctuation">(</span>bucket_count<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 申请新的桶数组</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>size_ <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>size_type i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> bucket_size_<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>	<span class="token comment">// 处理每个桶</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> first <span class="token operator">=</span> buckets_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> first<span class="token punctuation">;</span> first <span class="token operator">=</span> first<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>	<span class="token comment">// 处理桶上的每个链表节点</span>
			<span class="token punctuation">{</span>
				<span class="token keyword">auto</span> tmp <span class="token operator">=</span> <span class="token function">create_node</span><span class="token punctuation">(</span>first<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">const</span> <span class="token keyword">auto</span> n <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>first<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> bucket_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">auto</span> f <span class="token operator">=</span> bucket<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">bool</span> is_inserted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> cur <span class="token operator">=</span> f<span class="token punctuation">;</span> cur<span class="token punctuation">;</span> cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_equal</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>first<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
						tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
						cur<span class="token operator">-&gt;</span>next <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
						is_inserted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>is_inserted<span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> f<span class="token punctuation">;</span>
					bucket<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	buckets_<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>bucket<span class="token punctuation">)</span><span class="token punctuation">;</span>
	bucket_size_ <span class="token operator">=</span> buckets_<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>扩容完成就可以直接插入了，这边允许值重复，所有搜索到一样的值直接插入就好了。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">insert_multi_noresize</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> n <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> first <span class="token operator">=</span> buckets_<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> tmp <span class="token operator">=</span> <span class="token function">create_node</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> cur <span class="token operator">=</span> first<span class="token punctuation">;</span> cur<span class="token punctuation">;</span> cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_equal</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果链表中存在相同键值的节点就马上插入，然后返回</span>
		<span class="token punctuation">{</span>
			tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
			cur<span class="token operator">-&gt;</span>next <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
			<span class="token operator">++</span>size_<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 否则插入在链表头部</span>
	tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> first<span class="token punctuation">;</span>
	buckets_<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
	<span class="token operator">++</span>size_<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>如果是不允许重复插入，找到相同的就直接返回了。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
pair<span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">insert_unique_noresize</span><span class="token punctuation">(</span><span class="token keyword">const</span> value_type<span class="token operator">&amp;</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> n <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">auto</span> first <span class="token operator">=</span> buckets_<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> cur <span class="token operator">=</span> first<span class="token punctuation">;</span> cur<span class="token punctuation">;</span> cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span>	<span class="token comment">// 查找链表是否有键值相同的</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_equal</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">return</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 让新节点成为链表的第一个节点</span>
	<span class="token keyword">auto</span> tmp <span class="token operator">=</span> <span class="token function">create_node</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	tmp<span class="token operator">-&gt;</span>next <span class="token operator">=</span> first<span class="token punctuation">;</span>
	buckets_<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
	<span class="token operator">++</span>size_<span class="token punctuation">;</span>
	<span class="token keyword">return</span> mystl<span class="token double-colon punctuation">::</span><span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>最后看一下哈希表的查找，理论上时间复杂度平均是O(1)，这边直接<code>hash</code>之后就能找到对应的桶，然后就是看桶挂在了多少个节点了。</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyEqual</span><span class="token operator">&gt;</span>
<span class="token keyword">typename</span> <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator <span class="token class-name">hashtable</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Hash<span class="token punctuation">,</span> KeyEqual<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> key_type<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">const</span> <span class="token keyword">auto</span> n <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	node_ptr first <span class="token operator">=</span> buckets_<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> first <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">is_equal</span><span class="token punctuation">(</span>value_traits<span class="token double-colon punctuation">::</span><span class="token function">get_key</span><span class="token punctuation">(</span>first<span class="token operator">-&gt;</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span> first <span class="token operator">=</span> first<span class="token operator">-&gt;</span>next<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="unordered-set、unordered-multiset、unordered-map和unordered-multimap"><a href="#unordered-set、unordered-multiset、unordered-map和unordered-multimap" class="header-anchor">#</a> unordered_set、unordered_multiset、unordered_map和unordered_multimap</h3> <p>这四个都是配接器，底层容器使用的hashtable，所以都是无序的。只是做了接口的转换，可以自己看源码。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/smileatl/smileatlRepository_source/edit/master/docs/25.项目/30.mytinystl/60.容器container.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/08/11, 01:11:25</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/ee9345/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">仿函数functional</div></a> <a href="/pages/c46ee9/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">算法algorithm</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/ee9345/" class="prev">仿函数functional</a></span> <span class="next"><a href="/pages/c46ee9/">算法algorithm</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/93a902/"><div>
            cpp新特性
            <!----></div></a> <span class="date">12-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/163c8a/"><div>
            复刷还是没记住的题
            <!----></div></a> <span class="date">12-04</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/2aa569/"><div>
            计算机网络
            <!----></div></a> <span class="date">12-04</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1355484300@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/smileatl" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>smileatl | <a href="https://github.com/smileatl/smileatlRepository_source/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4813674f.js" defer></script><script src="/assets/js/3.cf27d530.js" defer></script><script src="/assets/js/219.43da1c82.js" defer></script>
  </body>
</html>
